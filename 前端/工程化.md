**å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨**

è¿™äº›ç»å¸¸é‡å¤ä½¿ç”¨çš„å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº

## ç»Ÿä¸€ä»£ç é£æ ¼

åº”ç”¨ä»£ç è§„èŒƒæœ‰ä¸‰ç‚¹å¥½å¤„ï¼š

- å¼ºåˆ¶è§„èŒƒå›¢é˜Ÿç¼–ç è§„èŒƒå¯è®©æ–°æ—§æˆå‘˜ç¼–ç ä¹ æƒ¯ä¸€æ ·

- å¢åŠ é¡¹ç›®ä»£ç çš„å¯ç»´æŠ¤æ€§ä¸å¯æ¥å…¥æ€§ï¼Œæ–°æˆå‘˜èƒ½å¿«é€Ÿé€‚åº”é¡¹ç›®çš„æ¶æ„ä¸éœ€æ±‚

- ä¿éšœé¡¹ç›®æ•´ä½“è´¨é‡ï¼Œå¯å‡å°‘æ— ç”¨ä»£ç ã€é‡å¤ä»£ç ã€é”™è¯¯ä»£ç å’Œæ¼æ´ä»£ç çš„äº§ç”Ÿå‡ ç‡

Lint

éå†

å†å°†æ–°çš„

- é…ç½®Stylelintå¯æŸ¥çœ‹

- é…ç½®Eslintå¯æŸ¥çœ‹

- é…ç½®TypeScriptEslintå¯æŸ¥çœ‹

- é…ç½®VueEslintå¯æŸ¥çœ‹

**å¯ä»¥è€ƒè™‘å°†é…ç½®æ–‡ä»¶æ‰“åŒ…ä¸ºä¸€ä¸ªnpmåŒ…,ä¸‹ä¸‹æ¥åæœ¬åœ°å¼•ç”¨é…ç½®,æˆ–è€…ç¼–è¾‘å™¨é…ç½®**

### eslint

```javascript
//eslint-config-airbnb-base //(æ›´ä¸¥æ ¼,æ¨è)æä¾›airbnbé£æ ¼çš„ä»£ç è§„èŒƒ
//eslint-config-standard    //(ç›¸å¯¹å®½æ¾)æä¾›standardé£æ ¼çš„ä»£ç è§„èŒƒ
//eslint-plugin-import      //ç”¨äºæ£€æŸ¥ ES6 çš„ import/export è¯­æ³•
//eslint-plugin-vue         //å¸®åŠ©æ£€æŸ¥ Vue ç‰¹æœ‰çš„è¯­æ³•å’Œæœ€ä½³å®è·µ
//vite-plugin-eslint        //åœ¨ Vite æ„å»ºè¿‡ç¨‹ä¸­é›†æˆ ESLint,è‡ªåŠ¨æ‰§è¡Œä»£ç æ£€æŸ¥

//ä¿å­˜è‡ªåŠ¨æ ¼å¼åŒ–
//@vue/cli-plugin-eslint    //Â Vue CLIçš„ä¸€ä¸ªæ’ä»¶,ç”¨è¿™ä¸ªvuecliä¼šæ”¯æŒlintOnSaveé€‰é¡¹,åŒæ—¶ä¼šå®‰è£…eslintåŠå…¶ç›¸å…³ä¾èµ–
//vue2
npm i eslint@8.57.0 eslint-plugin-import eslint-plugin-vue eslint-config-airbnb-base -D
//vue3
npm i eslint@8.57.0 eslint-plugin-import eslint-plugin-vue vite-plugin-eslint eslint-config-airbnb-base -D

//åœ¨package.jsonä¸­çš„scriptsé…ç½®é¡¹ä¸­æ·»åŠ linté…ç½®é¡¹
    //è‹¥æ— æ•ˆ,æ‰‹åŠ¨æ·»åŠ 
npm set-script lint "eslint --fix \"./src/**/*.{js,jsx,ts,tsx}\""
```

### stylelint

```javascript
//stylelint                         //CSS/SCSS/Lessä»£ç æ£€æŸ¥å·¥å…·
    //stylelint-config-recess-order     //è§„å®šcsså±æ€§çš„ä¹¦å†™é¡ºåº(è¦æŠ˜ç£¨è‡ªå·±å—?)
    //stylelint-config-standard         //Stylelint çš„æ ‡å‡†é…ç½®,åŒ…å«äº†ä¸€ç»„å¸¸è§çš„ CSS ç¼–ç æœ€ä½³å®è·µã€‚
    //stylelint-config-standard-vue     //åœ¨ stylelint-config-standard çš„åŸºç¡€ä¸Šæ–°å¢äº†ä¸€äº› Vue ç‰¹æœ‰çš„è§„åˆ™
    //stylelint-config-standard-scss    //åœ¨ stylelint-config-standard çš„åŸºç¡€ä¸Šæ–°å¢äº†stylelint-config-recommended-scssçš„å¤§éƒ¨åˆ†è§„åˆ™,åŒæ—¶é€‚åº”ä¸sass    
    //stylelint-config-standard-less    //åœ¨ stylelint-config-standard çš„åŸºç¡€ä¸Šæ–°å¢äº†stylelint-config-recommended-lessçš„å¤§éƒ¨åˆ†è§„åˆ™
    
    //stylelint-config-sass-guidelines  //åŒ…å«äº†ä¸€ç»„é’ˆå¯¹ ä»…sass çš„æœ€ä½³å®è·µè§„åˆ™
    //stylelint-config-recommended-scss //åŒ…å«äº†ä¸€ç»„é’ˆå¯¹ ä»…SCSS çš„æœ€ä½³å®è·µè§„åˆ™
    //stylelint-config-recommended-less //åŒ…å«äº†ä¸€ç»„é’ˆå¯¹ ä»…less çš„æœ€ä½³å®è·µè§„åˆ™

//ä»…cssçš„vue
npm i stylelint  stylelint-config-standard stylelint-config-standard-vue -D
â€‹//ä»…css sass scssçš„vue
npm i stylelint  stylelint-config-standard stylelint-config-standard-vue stylelint-config-standard-scss -D
//ä»…css sass scss lessçš„vue
npm i stylelint  stylelint-config-standard stylelint-config-standard-vue stylelint-config-standard-scss stylelint-config-standard-less -D

```

## ç»Ÿä¸€æäº¤è§„èŒƒ

```
//husky                            //æ“ä½œ git é’©å­çš„å·¥å…·
//lint-staged                      //æœ¬åœ°æš‚å­˜ä»£ç æ£€æŸ¥å·¥å…·
//commitlint                       //commit ä¿¡æ¯æ ¡éªŒå·¥å…·
//@commitlint/config-conventional  //æä¾›ä¸€äº›é»˜è®¤é…ç½®
//commitizen                       //è¾…åŠ© commit ä¿¡æ¯ ,å°±åƒè¿™æ ·,é€šè¿‡é€‰æ‹©è¾“å…¥,è§„èŒƒæäº¤ä¿¡æ¯
```

### husky

æ“ä½œ git é’©å­çš„å·¥å…·,å¸¸è§é’©å­å¦‚ä¸‹ï¼š

- pre-commit   æäº¤å‰çš„é’©å­

- commit-msg æäº¤ä¿¡æ¯é’©å­

- pre-push       pushå‰çš„é’©å­

```javascript
npm i husky@^7.0.4 -D

//åœ¨package.jsonä¸­çš„scriptsé…ç½®é¡¹ æ·»åŠ  prepare é…ç½®,9ç‰ˆæœ¬ä»¥ä¸Šæ‰§è¡Œhusky initä¼šè‡ªåŠ¨æ·»åŠ 
    //å¦‚æœæ— æ•ˆå»ºè®®æ‰‹åŠ¨æ·»åŠ 
npm set-script prepare "husky install"             

//åˆå§‹åŒ–husky,å°† git hooks é’©å­äº¤ç”±,huskyæ‰§è¡Œ
npm run prepare
```

### lint-staged

æœ¬åœ°æš‚å­˜ä»£ç æ£€æŸ¥å·¥å…·

```javascript
npm i lint-staged@^9.5.0 -D
//åœ¨.huskyç›®å½•ä¸‹çš„pre-commitæ–‡ä»¶(å¦‚æœæ²¡æœ‰ä¼šåˆ›å»º) æ·»åŠ  npx lint-staged å‘½ä»¤                                    
npx husky add .husky/pre-commit "npx lint-staged"  

//æ ¹ç›®å½•åˆ›å»º.lintstagedrc.jsonÂ æ–‡ä»¶æˆ–åœ¨package.jsonä¸­æ·»åŠ lint-stagedé…ç½®é¡¹ æ·»åŠ ä»¥ä¸‹ä»£ç 
{
    //æäº¤æ—¶æ£€éªŒæš‚å­˜åŒºçš„js,jsx,ts,tsxæ–‡ä»¶
    "*.{js,jsx,ts,tsx,vue}": [
      "eslint . --ext .vue,.js,.jsx,.ts,.tsx --fix --ignore-path .gitignore",
      "prettier --write  \"src/**/*.{js,tsx,css,less,scss,vue,html,md}\"",
      "stylelint --cache --fix \"**/*.{vue}\" --cache --cache-location node_modules/.cache/stylelint/"
    ],
    "*.{scss,less}": [
      "prettier --write  \"src/**/*.{js,tsx,css,less,scss,vue,html,md}\"",
      "stylelint --cache --fix \"**/*.{less,postcss,css,scss}\" --cache --cache-location node_modules/.cache/stylelint/"
    ],
    "{!(package)*.json,*.code-snippets,.!(browserslist)*rc}": [
      "prettier --write"
    ],
    "package.json": [
      "prettier --write"
    ],
    "*.md": [
      "prettier --write"
    ]
}
```

### **commitlint**

- **commitlintï¼š**commit ä¿¡æ¯æ ¡éªŒå·¥å…·

- **@commitlint/config-conventionalï¼š**æä¾›ä¸€äº›é»˜è®¤é…ç½®,æ ‡è¯†é‡‡ç”¨ä»€ä¹ˆè§„èŒƒæ¥æ‰§è¡Œæ¶ˆæ¯æ ¡éªŒ, é»˜è®¤æ˜¯**Angular**çš„æäº¤è§„èŒƒ

```javascript
npm i commitlint@^14.1.0 @commitlint/config-conventional@^14.1.0 -D
npx husky add .husky/commit-msg "npm run commitlint"

//æ·»åŠ æ–‡ä»¶.commitlintrc.js
module.exports = {
  extends: ['@commitlint/config-conventional']
};
//æˆ–è€…åœ¨package.jsonä¸­æ·»åŠ 
"commitlint": {
    "extends": [
        "@commitlint/config-conventional"
    ]
},      
```

**æ³¨æ„è¦åŠ ç©ºæ ¼**

æä¾›

<type>(<scope>): <short description>

[optional body]

[optional footer(s)]

```javascript
//å¦‚éœ€ä¿®æ”¹@commitlint/config-conventionalçš„é»˜è®¤é…ç½®,çœ‹è‡ªå®šä¹‰æäº¤è§„èŒƒ,ç”¨è‡ªå®šä¹‰çš„è¦†ç›–å®ƒ

//æ·»åŠ commitlint.config.jsæˆ–.commitlintrc.js
module.exports = {
    extends: ['@commitlint/config-conventional'],
}
//æˆ–è€…åœ¨package.jsonä¸­æ·»åŠ 
"commitlint": {
    "extends": ["@commitlint/config-conventional"]
}
```

| ç±»å‹ | æè¿° | 
| -- | -- |
| feat | æ–°å¢åŠŸèƒ½ï¼Œè¿­ä»£é¡¹ç›®éœ€æ±‚ | 
| refactor | é‡æ„ä»£ç ï¼Œéæ–°å¢åŠŸèƒ½ä¹Ÿéä¿®å¤ç¼ºé™· | 
| perf | ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ | 
| test | æ–°å¢æµ‹è¯•ï¼Œè¿½åŠ æµ‹è¯•ç”¨ä¾‹éªŒè¯ä»£ç  | 
| style | ä»£ç æ ¼å¼ä¿®æ”¹, æ³¨æ„ä¸æ˜¯ css ä¿®æ”¹ | 
| fix | ä¿®å¤ç¼ºé™· | 
|   |   | 
| revert | å›æ»šç‰ˆæœ¬ï¼Œæ’¤é”€æŸæ¬¡ä»£ç æäº¤ | 
| merge | åˆå¹¶åˆ†æ”¯ï¼Œåˆå¹¶åˆ†æ”¯ä»£ç åˆ°å…¶ä»–åˆ†æ”¯ | 
|  |   | 
| docs | æ›´æ–°æ–‡æ¡£ï¼Œä»…ä¿®æ”¹æ–‡æ¡£ä¸ä¿®æ”¹ä»£ç  | 
| build | ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨ | 
| chore | å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰ | 
|   |   | 
| ci | æ›´æ–°è„šæœ¬ï¼Œæ”¹åŠ¨CIæˆ–æ‰§è¡Œè„šæœ¬é…ç½® | 


#### è‡ªå®šä¹‰æäº¤è§„èŒƒ

é»˜è®¤æäº¤è§„èŒƒ<type>(<scope>): <subject>

[commitlintä¸­æ–‡æ–‡æ¡£](https://blog.csdn.net/qq_21197033/article/details/128609033)

å¦‚æœè‡ªå®šä¹‰æäº¤ä¿¡æ¯æ ¡éªŒå°±ä¸éœ€è¦[@commitlint/config-conventional](https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional)

[commitlint](https://commitlint.js.org/reference/plugins.html)å¯ä»¥å£°æ˜æœ¬åœ°æ’ä»¶,ä½†æ˜¯åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæœ¬åœ°æ’ä»¶

```javascript
//æ·»åŠ commitlint.config.jsæˆ–.commitlintrc.js
//ä»¥ä¸‹è‡ªå®šä¹‰äº†ä¸€ä¸ªå«commit-message-ruleçš„æœ¬åœ°æ’ä»¶,å¹¶åœ¨rulesä¸­å®šä¹‰äº†å®ƒçš„ä½¿ç”¨èŒƒå›´

module.exports = {
  //extends: ['@commitlint/config-conventional'],
  //æ˜¯å¦ä½¿ç”¨é»˜è®¤å¿½ç•¥è§„åˆ™
  //defaultIgnores: true,
  // ä»€ä¹ˆæ¡ä»¶å¿½ç•¥æäº¤ä¿¡æ¯
  ignores: [(commit) => commit.includes('init')],
  //æäº¤éªŒè¯å¤±è´¥æ—¶ï¼Œå°†æ˜¾ç¤ºæ­¤ URL
  helpUrl: 'http://172.26.0.17:8090/pages/viewpage.action?pageId=66330',
  // [è§„åˆ™åç§°]:[level, applicable, value]
  // level æ ¡éªŒç­‰çº§
      // 0 ç¦ç”¨
      // 1 è­¦å‘Š
      // 2 é”™è¯¯
  // applicable è§„åˆ™åŒ¹é…æ¨¡å¼
      // always æ­£åŒ¹é…
      // never ååŒ¹é…
      // value å‚æ•°å€¼
  // è§„åˆ™å¯æ¥æ”¶å‚æ•°ï¼š
  // è§„åˆ™æ•°ç»„ Array
  // è¿”å›è§„åˆ™æ•°ç»„çš„å‡½æ•° () => array
  // Promiseè§„åˆ™æ•°ç»„ Promiseã€ŠArrayã€‹
  rules: {
    'commit-message-rule': [2, 'always'],
  },
  plugins: [
    {
      rules: {
        'commit-message-rule': ({ header }) => {
          // const noIssueReg = /[N|n][O|o][I|i][S|s][S|s][U|u][E|e]\;\s*[^\s]+\s*/;
          const IssueReg = /\s*[I|i][S|s][S|s][U|u][E|e]\s*\:\s*[a-zA-Z]+-[0-9]+\s*\;[\s\S]*/;
          return [IssueReg.test(header), 'æ‚¨çš„æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒï¼æ­£ç¡®çš„æ ¼å¼ä¸º(ç¤ºä¾‹)ï¼šIssue:xxxx-000;xxxxxx'];
        },
      },
    },
  ],
};

```

### commitizen

è¾…åŠ© commit ä¿¡æ¯,åªæ”¯æŒæ‰‹åŠ¨è¾“å…¥git czå‘½ä»¤è§¦å‘

```javascript
//cz-conventional-changelog æä¾›é»˜è®¤çš„git czæç¤º
//cz-customizable           è‡ªå®šä¹‰git czçš„æç¤º
npm i commitizen cz-customizable -D

husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'

//åœ¨package.json çš„scriptsé…ç½®é¡¹ ä¸­æ·»åŠ  commit æŒ‡ä»¤, æ‰§è¡Œ `git-cz` æŒ‡ä»¤
    //æ— æ•ˆè¯·æ‰‹åŠ¨æ·»åŠ 
npm set-script commit "git-cz"
//æŒ‡å®špackage.jsonä¸­ config/commitizen/path ä¸º"./node_modules/cz-customizable"
npx commitizen init cz-customizable --save-dev --save-exact
```

#### è‡ªå®šä¹‰czä¿¡æ¯

```javascript
 //å¢åŠ  .cz-config.js
   'use strict'
  module.exports = {
    types: [
      { value: 'âœ¨æ–°å¢', name: 'æ–°å¢:    æ–°çš„å†…å®¹' },
      { value: 'ğŸ›ä¿®å¤', name: 'ä¿®å¤:    ä¿®å¤ä¸€ä¸ªBug' },
      { value: 'ğŸ“æ–‡æ¡£', name: 'æ–‡æ¡£:    å˜æ›´çš„åªæœ‰æ–‡æ¡£' },
      { value: 'ğŸ’„æ ¼å¼', name: 'æ ¼å¼:    ç©ºæ ¼, åˆ†å·ç­‰æ ¼å¼ä¿®å¤' },
      { value: 'â™»ï¸é‡æ„', name: 'é‡æ„:    ä»£ç é‡æ„ï¼Œæ³¨æ„å’Œç‰¹æ€§ã€ä¿®å¤åŒºåˆ†å¼€' },
      { value: 'âš¡ï¸æ€§èƒ½', name: 'æ€§èƒ½:    æå‡æ€§èƒ½' },
      { value: 'âœ…æµ‹è¯•', name: 'æµ‹è¯•:    æ·»åŠ ä¸€ä¸ªæµ‹è¯•' },
      { value: 'ğŸ”§å·¥å…·', name: 'å·¥å…·:    å¼€å‘å·¥å…·å˜åŠ¨(æ„å»ºã€è„šæ‰‹æ¶å·¥å…·ç­‰)' },
      { value: 'âªå›æ»š', name: 'å›æ»š:    ä»£ç å›é€€' }
    ],
    scopes: [
      { name: 'leetcode' },
      { name: 'javascript' },
      { name: 'typescript' },
      { name: 'Vue' },
      { name: 'node' }
    ],
    // it needs to match the value for field type. Eg.: 'fix'
    /*  scopeOverrides: {
      fix: [
        {name: 'merge'},
        {name: 'style'},
        {name: 'e2eTest'},
        {name: 'unitTest'}
      ]
    },  */
    // override the messages, defaults are as follows
    messages: {
      type: 'é€‰æ‹©ä¸€ç§ä½ çš„æäº¤ç±»å‹:',
      scope: 'é€‰æ‹©ä¸€ä¸ªscope (å¯é€‰):',
      // used if allowCustomScopes is true
      customScope: 'Denote the SCOPE of this change:',
      subject: 'çŸ­è¯´æ˜:\n',
      body: 'é•¿è¯´æ˜ï¼Œä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰)ï¼š\n',
      breaking: 'éå…¼å®¹æ€§è¯´æ˜ (å¯é€‰):\n',
      footer: 'å…³è”å…³é—­çš„issueï¼Œä¾‹å¦‚ï¼š#31, #34(å¯é€‰):\n',
      confirmCommit: 'ç¡®å®šæäº¤è¯´æ˜?(yes/no)'
    },
    allowCustomScopes: true,
    allowBreakingChanges: ['ç‰¹æ€§', 'ä¿®å¤'],
    // limit subject length
    subjectLimit: 100
  }

```

## CI/CD

gitlabæä¾›äº† CI/CDåŠŸèƒ½ï¼Œgitlab-ci.yml æ–‡ä»¶æ˜¯ GitLab CI/CD é…ç½®çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œå¸¸è§é…ç½®å¦‚ä¸‹ï¼š

- stagesï¼šå®šä¹‰äº†æµæ°´çº¿çš„ä¸åŒé˜¶æ®µ(ä½œä¸š)ï¼ŒæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚

- variablesï¼šå®šä¹‰äº†å…¨å±€å˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥åœ¨æ•´ä¸ª gitlab-ci.yml æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚

- before_scriptï¼šåœ¨æ¯ä¸ªä½œä¸šä¹‹å‰è¿è¡Œçš„å‘½ä»¤ã€‚

- jobs(å¯ä¸æ˜¾ç¤ºå£°æ˜,æ»¡è¶³jobç»“æ„çš„é…ç½®é¡¹ä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºjob)ï¼šå®šä¹‰æ¯ä¸ªä½œä¸šåšçš„äº‹æƒ…ï¼Œè¿™é‡Œbuild_jobä½œä¸šå°±æ˜¯å®šä¹‰buildé˜¶æ®µåšçš„äº‹æƒ…ã€‚

- stageï¼šå®šä¹‰è¿™ä¸ªä½œä¸šå¯¹åº”çš„æµæ°´çº¿é˜¶æ®µ

- artifactsï¼šç”¨äºå®šä¹‰æ„å»ºäº§ç‰©ï¼Œå¯ä»¥åœ¨åç»­é˜¶æ®µæˆ–ä½œä¸šä¸­ä½¿ç”¨ã€‚

- pathsï¼šæ„å»ºäº§ç‰©æ‰€åœ¨ç›®å½•

- cacheï¼šç¼“å­˜ä¾èµ–é¡¹æˆ–æ„å»ºç»“æœï¼Œä»¥åŠ å¿«åç»­çš„æ„å»ºé€Ÿåº¦ã€‚

- keyï¼š

- keyç›¸å½“äºç»™ç¼“å­˜å‘½åˆ«åï¼Œç¼“å­˜ç©ºé—´å…·æœ‰è¿™ä¸ªåå­—çš„ç¼“å­˜å°±ä¼šä½¿ç”¨ç¼“å­˜

- é»˜è®¤æ˜¯defaultï¼Œæ‰€æœ‰æœªæŒ‡å®šç¼“å­˜é”®çš„jobå°†å…±äº«åŒä¸€ä¸ªç¼“å­˜ç©ºé—´

- policyï¼šé»˜è®¤ pull-push è¡¨ç¤ºå…ˆæ¢å¤ç¼“å­˜ï¼Œç„¶åæ›´æ–°ç¼“å­˜

- pathsï¼šåº”è¯¥ç¼“å­˜çš„ç›®å½•

- dependenciesï¼šå®šä¹‰ä½œä¸šä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªä½œä¸šä¾èµ–å“ªä¸ªä½œä¸šã€‚

- servicesï¼šä¸ºä½œä¸šæä¾›è¾…åŠ©æœåŠ¡ï¼Œå¦‚æ•°æ®åº“æœåŠ¡ã€‚

```javascript
//-ä»£è¡¨ä¸€ä¸ªæ–°çš„å‘½ä»¤
stages:
  - build
  - test
  - deploy

variables:
  NODE_ENV: production
  DEFAULT_BRANCH: main

before_script:
  - echo "Setting up the environment..."
  - npm install

build_job:
  stage: build
  script:
    - echo "Building the project..."
    - npm run build
  artifacts:
    paths:
      - dist/
  only:
    - $DEFAULT_BRANCH

test_job:
  stage: test
  script:
    - echo "Running tests..."
    - npm test
  services:
    -mysql:latest
  dependencies:
    -build_job
```

## åˆ‡æ¢Npmé•œåƒ

npm i nrm -g

| å‘½ä»¤ | åŠŸèƒ½ | 
| -- | -- |
| nrm add <name> <url> | æ–°å¢é•œåƒ | 
| nrm del <name> | åˆ é™¤é•œåƒ | 
| nrm test <name> | æµ‹è¯•é•œåƒ | 
| nrm use <name> | åˆ‡æ¢é•œåƒ | 
| nrm current | æŸ¥çœ‹é•œåƒ | 
| nrm ls | æŸ¥çœ‹é•œåƒåˆ—è¡¨ | 


## åˆ‡æ¢nodeç‰ˆæœ¬

npm i nvm -g

| å‘½ä»¤ | åŠŸèƒ½ | 
| -- | -- |
| nvm ls | æŸ¥çœ‹æœ¬åœ°nodeç‰ˆæœ¬åˆ—è¡¨ | 
| nvm use <version> | åˆ‡æ¢ç‰ˆæœ¬ | 
| nvm install <version> | ä¸‹è½½ä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬çš„node | 
| nvm uninstall <version> | å¸è½½ä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬çš„node | 


## nodeæ”¯æŒESM

### æ¨¡å—æ–¹æ¡ˆ

åœ¨

![](images/WEBRESOURCEf6a4605bb702de4b7946aa074a0ff947æˆªå›¾.png)

### CJSä¸ESM

| - | CJS | ESM | 
| -- | -- | -- |
| è¯­æ³•ç±»å‹ | åŠ¨æ€ | é™æ€ | 
| å…³é”®å£°æ˜ | require | exportä¸import | 
| åŠ è½½æ–¹å¼ | è¿è¡Œæ—¶åŠ è½½ | ç¼–è¯‘æ—¶åŠ è½½ | 
| åŠ è½½è¡Œä¸º | åŒæ­¥åŠ è½½ | å¼‚æ­¥åŠ è½½ | 
| ä¹¦å†™ä½ç½® | ä»»ä½•ä½ç½® | é¡¶å±‚ä½ç½® | 
| æŒ‡é’ˆæŒ‡å‘ | thisæŒ‡å‘ | thisæŒ‡å‘ | 
| æ‰§è¡Œé¡ºåº | é¦–æ¬¡å¼•ç”¨æ—¶ | å¼•ç”¨æ—¶ç”Ÿæˆ | 
| å±æ€§å¼•ç”¨ | åŸºæœ¬ç±»å‹å±äº | æ‰€æœ‰ | 


- è¿è¡Œæ—¶åŠ è½½æŒ‡æ•´ä½“åŠ è½½æ¨¡å—ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œå†ä»å¯¹è±¡ä¸­è·å–æ‰€éœ€çš„å±æ€§æ–¹æ³•å»åŠ è½½ã€‚æœ€å¤§ç‰¹æ€§æ˜¯å…¨éƒ¨åŠ è½½ï¼Œåªæœ‰è¿è¡Œæ—¶æ‰èƒ½å¾—åˆ°è¯¥å¯¹è±¡ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶åšé™æ€ä¼˜åŒ–ã€‚

- ç¼–è¯‘æ—¶åŠ è½½æŒ‡ç›´æ¥ä»æ¨¡å—ä¸­è·å–æ‰€éœ€çš„å±æ€§æ–¹æ³•å»åŠ è½½ã€‚æœ€å¤§ç‰¹æ€§æ˜¯æŒ‰éœ€åŠ è½½ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å®Œæˆæ¨¡å—åŠ è½½ï¼Œæ•ˆç‡æ¯”å…¶ä»–æ–¹æ¡ˆé«˜ï¼Œæ— æ³•å¼•ç”¨æ¨¡å—æœ¬èº«(æœ¬èº«ä¸æ˜¯å¯¹è±¡)ï¼Œä½†å¯æ‹“å±•JSé«˜çº§è¯­æ³•(å®ä¸ç±»å‹æ ¡éªŒ)ã€‚

### nodeå¯¹ESMçš„åŸç”Ÿæ”¯æŒ

2017å¹´10æœˆ31æ—¥

```bash
bashå¤åˆ¶ä»£ç node --experimental-modules index.js

```

ä½†

æ¥ç€

--experimental-modules

- ä½¿ç”¨typeæŒ‡å®šæ¨¡å—æ–¹æ¡ˆ

- åœ¨package.jsonä¸­æŒ‡å®štypeä¸ºcommonjsï¼Œåˆ™ä½¿ç”¨CJS

- åœ¨package.jsonä¸­æŒ‡å®štypeä¸ºmoduleï¼Œåˆ™ä½¿ç”¨ESM

- ä½¿ç”¨--input-typeæŒ‡å®šå…¥å£æ–‡ä»¶çš„æ¨¡å—æ–¹æ¡ˆï¼Œä¸typeä¸€æ ·

- å‘½ä»¤ä¸­åŠ ä¸Š--input-type=commonjsï¼Œåˆ™ä½¿ç”¨CJS

- å‘½ä»¤ä¸­åŠ ä¸Š--input-type=moduleï¼Œåˆ™ä½¿ç”¨ESM

- æ”¯æŒæ–°æ–‡ä»¶åç¼€.cjs

- æ–‡ä»¶åç¼€ä½¿ç”¨.cjsï¼Œåˆ™ä½¿ç”¨CJS

- ä½¿ç”¨--es-module-specifier-resolutionæŒ‡å®šæ–‡ä»¶åç§°å¼•ç”¨æ–¹å¼

- å‘½ä»¤ä¸­åŠ ä¸Š--es-module-specifier-resolution=explicitï¼Œåˆ™å¼•ç”¨æ¨¡å—æ—¶å¿…é¡»ä½¿ç”¨æ–‡ä»¶åç¼€(é»˜è®¤)

- å‘½ä»¤ä¸­åŠ ä¸Š--es-module-specifier-resolution=nodeï¼Œåˆ™å¼•ç”¨æ¨¡å—æ—¶æ— éœ€ä½¿ç”¨æ–‡ä»¶åç¼€

- ä½¿ç”¨mainæ ¹æ®typeæŒ‡å®šæ¨¡å—æ–¹æ¡ˆåŠ è½½æ–‡ä»¶

- åœ¨package.jsonä¸­æŒ‡å®šmianåä¼šæ ¹æ®typeæŒ‡å®šæ¨¡å—æ–¹æ¡ˆåŠ è½½æ–‡ä»¶

### CJS/ESMåˆ¤æ–­æ–¹å¼

Node

ç®€è€Œè¨€ä¹‹ï¼Œ

å½“ç„¶è¿˜å¯é€šè¿‡å‘½ä»¤å‚æ•°å¤„ç†ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºè¿™æ ·åšæ“ä½œè¿‡å¤šï¼Œæ‰€ä»¥å°±ä¸è®¨è®ºå…·ä½“æ–¹æ³•äº†ã€‚

åˆšæ‰è¯´äº†

1. Â æ–‡ä»¶åç¼€ä¸º.mjs

1. Â æ–‡ä»¶åç¼€ä¸º.jsä¸”åœ¨package.jsonä¸­æŒ‡å®štypeä¸ºmodule

1. Â å‘½ä»¤ä¸­åŠ ä¸Š--input-type=module

1. Â å‘½ä»¤ä¸­åŠ ä¸Š--eval cmd

### esmä¸­å¦‚ä½•ä½¿ç”¨__dirnameå’Œ__filename

```javascript
import { dirname } from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
console.log(__filename, __dirname,import.meta.url);
```

ç¤ºä¾‹å¼•ç”¨æˆ‘å¼€æºçš„[@yangzw/bruce-us](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Ftree%2Fmain%2Fpackages%2Fus)ï¼Œå…¶ä¸­

```js
import { NodeType } from "@yangzw/bruce-us/dist/node";

console.log(NodeType());
```

### æŸ¥çœ‹nodeå¯¹åº”çš„npmç‰ˆæœ¬

ä½¿ç”¨[Node Releases](https://link.juejin.cn/?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload%2Freleases)

### ä½ç‰ˆæœ¬nodeå…¼å®¹

è‹¥éœ€å…¼å®¹

```javascript
{
    "babel": {
        "presets": [
            ["@babel/preset-env", { "targets": { "node": "8.0.0" } }]
        ]
    }
}

```

## æœåŠ¡ç®¡ç†

- nodemoné€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼Œè°ƒè¯•ä»£ç æ›´æ–¹ä¾¿ï¼›

- foreveré€‚ç”¨äºæ— éœ€ç›‘æ§ä¸”è®¿é—®é‡è¾ƒå°çš„NodeæœåŠ¡ï¼›

- pm2é€‚ç”¨äºéœ€ç›‘æ§ä¸”è®¿é—®é‡è¾ƒå¤§çš„NodeæœåŠ¡ï¼›

| å·¥å…· | ç¨³å®šæ€§ | è¿è¡Œç¯å¢ƒ | å¹¶å‘é‡çº§ | åå°è¿è¡Œ | ä»£ç ç›‘å¬ | çŠ¶æ€ç›‘æ§ | æ—¥å¿—ç®¡ç† | é›†ç¾¤æ¨¡å¼ | 
| -- | -- | -- | -- | -- | -- | -- | -- | -- |
|  | ä¸­ç­‰ | å¼€å‘ç¯å¢ƒ | æ—  | âŒ | âœ”ï¸ | âŒ | âŒ | âŒ | 
|  | ä¸­ç­‰ | ç”Ÿäº§ç¯å¢ƒ | è¾ƒå° | âœ”ï¸ | âœ”ï¸ | âŒ | âœ”ï¸ | âŒ | 
|  | è¾ƒé«˜ | ç”Ÿäº§ç¯å¢ƒ | è¾ƒå¤§ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | âœ”ï¸ | 


### pm2

pm2 æ˜¯nodeçš„ process manager(è¿›ç¨‹ç®¡ç†)çš„ç¬¬äºŒå¤§ç‰ˆæœ¬

ä¸»è¦åŠŸèƒ½æ˜¯

npm install -g pm2

| å‘½ä»¤ | ä½œç”¨ | 
| -- | -- |
| pm2 ecosystem | åˆ›å»ºä¸€ä¸ªecosystem.config.jsæ–‡ä»¶, | 
| pm2 link xxx xxx | é“¾æ¥è¿œç¨‹app.pm2.ioç½‘ç«™åˆ›å»ºçš„bucket,ç”¨äºåœ¨çº¿ç›‘æ§ | 
| pm2 logs/flush | æŸ¥çœ‹/æ¸…ç©ºæ—¥å¿— | 
| pm2 logs/flush è¿›ç¨‹å/è¿›ç¨‹id | æŸ¥çœ‹/æ¸…ç©ºå•ä¸ªè¿›ç¨‹çš„æ—¥å¿— | 
| pm2 list/stop/restart/delete all | æŸ¥çœ‹/åœæ­¢/é‡å¯/åˆ é™¤æ‰€æœ‰è¿›ç¨‹ | 
| pm2 show/stop/restart/delete/monit è¿›ç¨‹id | æŸ¥çœ‹å•ä¸ªè¿›ç¨‹çš„çŠ¶æ€ | 
| pm2 save/resurrect | ä¿å­˜/æ¢å¤è¿›ç¨‹çŠ¶æ€ | 
| pm2 scale åº”ç”¨ç¨‹åºå/id num/+num/-num | åŠ¨æ€è°ƒæ•´è¿›ç¨‹æ•°,æŒ‡å®šä¸ªæ•°/æ–°å¢ä¸ªæ•°/å‡å°‘ä¸ªæ•° | 
| pm2 start è¿›ç¨‹æ–‡ä»¶è·¯å¾„ | å¯åŠ¨è¿›ç¨‹ | 
| pm2 start è¿›ç¨‹æ–‡ä»¶è·¯å¾„  --max-memory-restart 200M | å¯åŠ¨è¿›ç¨‹,å¹¶é™åˆ¶æœ€å¤§é‡å¯å†…å­˜ä¸º200m,è¶…å‡ºå°±è‡ªåŠ¨é‡å¯ | 
| pm2 start app.js -i 0 | æ ¹æ®CPUæ ¸æ•°å¯åŠ¨ç›¸åº”æ•°é‡çš„è¿›ç¨‹,0/maxè¡¨ç¤ºä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„CPUæ ¸å¿ƒ | 


### nodemonè‡ªåŠ¨é‡å¯æœåŠ¡

ä½¿ç”¨[nodemon](https://nodemon.io/),åœ¨

```json
{
    "nodemonConfig": {
        "env": {
            "NODE_ENV": "dev"
        },
        "execMap": {
            "js": "node --harmony"
        },
        "ext": "js json",
        "ignore": [
            "dist/"
        ],
        "watch": [
            "src/"
        ]
    }
}
```
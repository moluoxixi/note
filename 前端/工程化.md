**å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨**ã€‚åšå¥½ä¸€ä¸ªé¡¹ç›®å‰æœŸå‡†å¤‡å·¥ä½œå¾ˆé‡è¦ï¼Œå‰æœŸå‡†å¤‡æ— éå°±æ˜¯**åˆç†è§„åˆ’é¡¹ç›®ç»“æ„ã€æŒ‰éœ€ç¼–å†™æ„å»ºä»£ç ã€æ‰¹é‡åˆ›å»ºå…¥å£æ–‡ä»¶ã€æŒ‰éœ€å°è£…å·¥å…·å‡½æ•°**ç­‰ï¼Œè€Œ**æŒ‰éœ€å°è£…å·¥å…·å‡½æ•°**æ˜¯ä½œä¸ºä¸€ä¸ªé¡¹ç›®åŸºç¡€çš„é‡ä¸­ä¹‹é‡ï¼Œæ˜¯å¾ˆæœ‰å¿…è¦æå‰è§„åˆ’çš„ã€‚

è¿™äº›ç»å¸¸é‡å¤ä½¿ç”¨çš„å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº**æµè§ˆå™¨ç±»å‹ã€æ ¼å¼æ—¶é—´å·®ã€URLå‚æ•°ååºåˆ—åŒ–ã€è¿‡æ»¤XSS**ç­‰ã€‚ä¸ºäº†é¿å…åº”ç”¨å¼€å‘æ—¶é‡å¤çš„å¤åˆ¶ç²˜è´´æ“ä½œå¸¦æ¥ä¸å¿…è¦çš„éº»çƒ¦ï¼Œæœ‰äº›å¼€å‘è€…éƒ½ä¼šå°†è¿™äº›å·¥å…·å‡½æ•°æ ¹æ®åŠŸèƒ½åˆ’åˆ†å¹¶ç»Ÿä¸€å°è£…ï¼Œå†å‘å¸ƒåˆ°**Npmå…¬æœ‰ä»“åº“**ã€‚æ¯æ¬¡ä½¿ç”¨æ—¶ç›´æ¥å®‰è£…ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼Œå°†æ—¶é—´ç”¨åœ¨æ­£ç¡®çš„äº‹æƒ…ä¸­ã€‚
# é…å¥½çš„é…ç½®ç¤ºä¾‹
## vite
### å¸¸è§„é…ç½®
```js
// vite-config.js
import { fileURLToPath, URL } from 'node:url'  
import { defineConfig, loadEnv } from 'vite'  
import vue from '@vitejs/plugin-vue'  
import vueJsx from '@vitejs/plugin-vue-jsx'  
import vueDevTools from 'vite-plugin-vue-devtools'  
import viteCompression from 'vite-plugin-compression'  
import viteImagemin from 'vite-plugin-imagemin'  
import { createHtmlPlugin } from 'vite-plugin-html'  
import qiankun from "vite-plugin-qiankun";
// https://vitejs.dev/config/  
export default defineConfig((mode) => {  
  process.env = { ...process.env, ...loadEnv(mode, process.cwd()) }  
  return {
    // base: process.env.NODE_ENV === 'production' ? '/residentdoctor' : './',
    // ä¸Šçº¿å,å¿…é¡»æœ‰å›ºå®šçš„è·¯å¾„å‰ç¼€æ‰èƒ½nginxä»£ç†
    base: '/residentdoctor',
    plugins: [  
      vue(),  
      vueJsx(),  
      // vueDevTools(),  
      // ä¹¾å¤é…ç½®
      qiankun('residentdoctor', { //å­åº”ç”¨nameï¼Œé¡»ä¸å­åº”ç”¨ä¸­package.jsonä¸­çš„nameå±æ€§ç›¸åŒ  
        useDevMode: false  
      }),
      // é™æ€èµ„æºå‹ç¼©
      viteCompression({  
        verbose: true, // é»˜è®¤å³å¯  
        disable: false, // å¼€å¯å‹ç¼©(ä¸ç¦ç”¨)ï¼Œé»˜è®¤å³å¯  
        deleteOriginFile: false, // åˆ é™¤æºæ–‡ä»¶  
        threshold: 5120, // å‹ç¼©å‰æœ€å°æ–‡ä»¶å¤§å°  
        algorithm: 'gzip', // å‹ç¼©ç®—æ³•  
        ext: '.gz' // æ–‡ä»¶ç±»å‹  
      }),  
      // å›¾ç‰‡å‹ç¼©  
      viteImagemin({  
        gifsicle: {  
          optimizationLevel: 7,  
          interlaced: false  
        },  
        optipng: {  
          optimizationLevel: 7  
        },  
        mozjpeg: {  
          quality: 20  
        },  
        pngquant: {  
          quality: [0.8, 0.9],  
          speed: 4  
        },  
        svgo: {  
          plugins: [  
            {  
              name: 'removeViewBox'  
            },  
            {  
              name: 'removeEmptyAttrs',  
              active: false  
            }  
          ]  
        }  
      }),  
      createHtmlPlugin({  
        inject: {  
          data: {  
            title: process.env.VITE_APP_TITLE  
          }  
        }  
      }),  
      // cssImportPlugin()  
    ],  
    build: {  
      // å¤§èµ„æºæ‹†åˆ†  
      chunkSizeWarningLimit: 1500, //åŠ å¤§  
      rollupOptions: {  
        output: {  
          // é™æ€èµ„æºæ‰“åŒ…åšå¤„ç†  
          chunkFileNames: 'static/js/[name]-[hash].js',  
          entryFileNames: 'static/js/[name]-[hash].js',  
          assetFileNames: 'static/[ext]/[name]-[hash].[ext]', 
          // æŒ‡å®šå“ªäº›æ¨¡å—åº”è¯¥è¢«æ‰“åŒ…åˆ°åŒä¸€ä¸ªchunkä¸­,é€šå¸¸åªéœ€è¦æŒ‡å®šæ¯”è¾ƒå¤§çš„åŒ…
          manualChunks(id) {  
            if (id.includes('node_modules')) {
              //æå–*/node_modules/vite/**ä¸­node_modules/ååœ¨å­—ç¬¦ä¸²
              return id.toString().split('node_modules/')[1].split('/')[0].toString()  
            }  
          }  
        }  
      },
      // ç§»é™¤console.log&debugger
      terserOptions: {  
        compress: {  
          drop_console: true,  
          drop_debugger: true  
        }  
      }  
    },
    // è·¯å¾„æ˜ å°„
    resolve: {  
      alias: {  
        '@': fileURLToPath(new URL('./src', import.meta.url))  
      }  
    },
    server: {  
      proxy: {  
        '/ts-bs-his': {  
          target: 'http://192.168.208.26:9099',  
          secure: true,  
          changeOrigin: true,  
          configure: (proxy, options) => {  
            proxy.on('proxyReq', function (proxyReq, req, res, options) {  
              proxyReq.setHeader('appId', 'trasen')
            })  
          }  
        },  
        ...
      }  
    },
  }  
})
```

### qiankun é¢å¤–é…ç½®
#### vite-config.js
```js
// vite-config.js
...
export default defineConfig((mode) => {
	...,
	// baseéœ€ä¸entryç›¸åŒ,baseå¿…é¡»ä¸nginxä»£ç†çš„å‰ç¼€ç›¸åŒ,é¡¹ç›®è¿è¡Œåä¼šå˜ä¸ºurl/base,ä¹¾å¤ä¸»åº”ç”¨çš„entryéœ€ä¸baseç›¸åŒ
	base:'/residentdoctor',
	// element-plusçš„å‘½åç©ºé—´é…ç½®
	 css: {  
		 preprocessorOptions: {  
			 scss: {  
				 additionalData: `@use "./src/assets/styles/element/variable.scss" as *;`  
			 }  
		 }  
	 }  
})

```
#### main.js
```js
// main.js

// å¼•å…¥vue,æ ·å¼ç­‰
...
import App from './App.vue'  
  
import getRouter from './router'  
  
import { useThemeStore } from './stores/theme'

let app;  
  
/**  
 * @param container ä¸»åº”ç”¨ä¸‹å‘çš„propsä¸­çš„container,ä¹Ÿå°±æ˜¯å­åº”ç”¨çš„æ ¹èŠ‚ç‚¹  
 * å°†å­åº”ç”¨appendBodyçš„å…ƒç´ ,æŒ‚è½½åˆ°å­åº”ç”¨æ ¹å…ƒç´ èº«ä¸Š  
 * ç”¨äºè§£å†³ä¹¾å¤å­åº”ç”¨å¼€å¯å¦‚ä¸‹æ ·å¼éš”ç¦»æ–¹æ¡ˆå,æ·»åŠ åˆ°bodyçš„å…ƒç´ æ ·å¼å¤±æ•ˆ  
 * sandbox: {  
 *    ä»¥ä¸‹é…ç½®é¡¹åªèƒ½å¼€å¯ä¸€ä¸ª,å¦ä¸€ä¸ªè¦ä¸ºfalse  
 *    strictStyleIsolation: true,        //ä¸¥æ ¼æ¨¡å¼,å…¶å®å°±æ˜¯ç»™å­åº”ç”¨æ ¹èŠ‚ç‚¹æ”¹é€ ä¸ºshadowRoot,ä¹Ÿå°±æ˜¯å¥—ä¸ŠshadowDom  
 *    experimentalStyleIsolation: true,  //æ ·å¼éš”ç¦»,å°±æ˜¯ç»™å­åº”ç”¨çš„å…¨å±€æ ·å¼åŠ ä¸Šdiv[data-qiankun=`${appName}`],ä¼šå¯¼è‡´scopedä¸­çš„æ ·å¼æƒé‡å˜ä½  
 * },  
 */
const proxy = (container) => {
  if (document.body.appendChild.__isProxy__) return;  
  const revocable = Proxy.revocable(document.body.appendChild, {  
    apply (target, thisArg, [node]) {  
      if (container) {  
        container.appendChild(node);  
      } else {  
        target.call(thisArg, node);  
      }  
    }  
  });  
  if (revocable.proxy) {  
    document.body.appendChild = revocable.proxy;  
  }  
  document.body.appendChild.__isProxy__ = true;  
};  

/**
 * ç”¨äºç®¡ç†ä¸»é¢˜,æœ‰å¾ˆå¤šç§æ–¹æ¡ˆ,è¿™é‡Œä»…æ”¹å˜color-primaryçš„å€¼
 * å¸¸è§æ–¹æ¡ˆ:
 * 1.å±æ€§åˆ‡æ¢æ³• 
 * ç»™html/body,å†™ä¸Šä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ç”¨äºåˆ‡æ¢ä¸»é¢˜,ä¾‹å¦‚data-theme="dark"
 * è®¾ç½®csså˜é‡,ä¾‹å¦‚:
 * html[data-theme="theme1"] {
 *	--color-primary: #f98866;
 *	--color-secondary: #80bd9e;
 *	--color-buttons: #89da59;
 * 	--color-typography: #ff320e;
 * }
 * å†™åˆ‡æ¢ä¸»é¢˜æ–¹æ³•:
 * const changeTheme = (theme: string) => {
 *  document.body?.setAttribute("data-theme", theme);
 * };
 * 
 * 2.åŠ¨æ€åŠ è½½æ³•
 * é€šè¿‡rxjsä»é“¾æ¥åŠ¨æ€è¯·æ±‚ä¸»é¢˜é…ç½®,é€šè¿‡linkåŠ è½½,
 * å¥½å¤„æ˜¯å¯ä»¥å°†é™æ€èµ„æºå’Œä¸»é¢˜å…¨éƒ¨æŠ½ç¦»å‡ºæ¥ä½œä¸ºé¡¹ç›®ç»Ÿä¸€ç®¡ç†,æ–¹ä¾¿å®šåˆ¶åŒ–(oem)
*/
function themeManager(props){  
  const themeStore = useThemeStore()  
  try {  
    if (props.fn.getTheme) {  
      const themeColor = props.fn.getTheme();  
      if (themeColor) {  
        themeStore.setTheme(themeColor);  
      }  
    }  
    props.onGlobalStateChange((state) => {  
      //æ›´æ¢ä¸»é¢˜  
      if (state.action == "changeTheme") {  
        themeStore.setTheme(state.color);  
      }  
    });  
  } catch (e) {  
    console.log(e);  
  }  
}  
  
function render(props) {  
  const { container } = props;  
  proxy(container)  
  app = createApp(App);  
  // æ³¨å†ŒæŒ‡ä»¤  
  directives(app)  
  // æ³¨å†Œç»„ä»¶  
  for (const [key, component] of Object.entries(ElementPlusIconsVue)) {  
    app.component(key, component)  
  }  
  const pinia = createPinia()  
  pinia.use(piniaPluginPersistedstate)  
  app.provide('getUtils', utils)  
  app.use(pinia)  
  
  // æµ‹è¯•ä¸»é¢˜å˜æ›´  
  // const themeStore = useThemeStore()  
  // themeStore.setTheme('red');  const router = getRouter(props); 
  const router = getRouter(props); 
  app.use(router)  
  app.use(ElementPlus)  
  if(container){  
    const root = container.querySelector('#app');  
    app.mount(root);  
  }else{  
    app.mount('#app')  
  }  
}

// ç‹¬ç«‹è¿è¡Œæ—¶  
if (!qiankunWindow.__POWERED_BY_QIANKUN__) {  
  render({});  
}else{  
  renderWithQiankun({  
                      mount (props) {  
                        console.log("before props")  
                        render(props);  
                        themeManager(props);  
                        console.log("after props")  
                      },  
                      bootstrap () {  
                        console.log("%c ", "color: green;", "app bootstraped");  
                      },  
                      unmount (props) {  
                        app.unmount();  
                        app = null;  
                      },  
                    });  
}
```

#### App.vue
```html
// App.vue
<template>  
	<el-config-provider
		:locale="zhCn"  
		namespace="residentdoctor"  
		:empty-values="[undefined]"
	>  
		<div class="height-100" :style="`--residentdoctor-color-primary: ${themeColor || '#3A77FF'};`">  
			<RouterView />
		</div> 
	</el-config-provider>
</template>  
<script setup>  
import { RouterView } from 'vue-router'  
import zhCn from 'element-plus/dist/locale/zh-cn.mjs'  
import { useUserStore } from '@/stores/user'  
import {  computed } from 'vue'   
import { useThemeStore } from "@/stores/theme.js";  
  
const themeStore = useThemeStore();  
const themeColor = computed(() => themeStore.themeColor);  
</script>  
<style scoped></style>
```
#### router/index.js
```js
import { createRouter, createWebHistory } from 'vue-router'  
import { qiankunWindow } from 'vite-plugin-qiankun/dist/helper'
import { isEmpty,assign } from 'radash'

const routes= []

function getRouter(props) {  
  let base;  
  const routes=_.cloneDeep(Routes);  
  if (qiankunWindow.__POWERED_BY_QIANKUN__) {  
    const { activeRule } = props.data;  
    ... 
    base = activeRule;  
  }  
  else {  
    base = '/residentdoctor'  
  }  
  const router = createRouter({  
    history: createWebHistory(base),  
    routes  
  })

	
  router.beforeEach((to, from, next) => {
      _.assign(history.state, { current: from.fullPath })  
    }  
    next()  
  })  
  return router  
}  
  
export default getRouter
```

#### theme.js
```js
import { defineStore } from 'pinia'  
  
export const useThemeStore = defineStore({  
  id: 'theme',  
  state: () => ({  
    themeColor: '#3a77ff'  
  }),  
  actions: {  
    setTheme(color) {  
      this.themeColor = color  
    }  
  }  
})
```
## webpack
```

```
# ç»Ÿä¸€è§„èŒƒ
## ç¤ºä¾‹
```js
-->1.å®‰è£…eslintæ£€æŸ¥ä»£ç æ ¼å¼
	//vue2
	npm i -D eslint@8.57.0 eslint-plugin-import eslint-plugin-vue eslint-config-airbnb-base
	//vue3
	npm i -D eslint@8.57.0 eslint-plugin-import eslint-plugin-vue vite-plugin-eslint eslint-config-airbnb-base
	
	//react
	npm i -D eslint@8.57.0 eslint-plugin-import eslint-plugin-react vite-plugin-eslint eslint-config-airbnb-base

-->2.å®‰è£…prettier
	pnpm i -D prettier eslint-config-prettier eslint-plugin-prettier

-->3.å®‰è£…stylelintæ£€æŸ¥cssæ ¼å¼
	//css sass scss less
	npm i -D stylelint  stylelint-config-standard stylelint-config-standard-scss stylelint-config-standard-less
	
	//åŒ…å«vue
	npm i -D stylelint-config-standard-vue

-->4.å®‰è£…husky&lint-staged,å¹¶é…ç½®,é€šè¿‡huskyçš„pre-commité’©å­è°ƒç”¨lint-stagedæ ¡éªŒä»£ç æ ¼å¼
	pnpm install -D lint-staged
	//æ ¹ç›®å½•åˆ›å»º.lintstagedrc.jsonÂ æ–‡ä»¶æˆ–åœ¨package.jsonä¸­æ·»åŠ lint-stagedé…ç½®é¡¹ æ·»åŠ ä»¥ä¸‹ä»£ç 
		{  
		  "*.{js,jsx,ts,tsx,vue,md}": [  
		   "eslint --fix",  
		   "prettier --write"  
		  ],  
		  "*.{css,scss,less,jsx,tsx,vue}": [  
		   "stylelint --cache --fix --cache-location node_modules/.cache/stylelint/"  
		  ]  
		}
	// .husky/pre-commitæ–‡ä»¶ä¸­
		#!/bin/sh  
		. "$(dirname "$0")/_/husky.sh"
		
		#!è°ƒç”¨lint-stagedæ ¡éªŒæš‚å­˜åŒºçš„ä»£ç 
		npx lint-staged

-->5.å®‰è£…commitlintæ ¡éªŒæäº¤ä¿¡æ¯,ä¹Ÿå°±æ˜¯git commit -m "æäº¤ä¿¡æ¯" ä¸­åŒå¼•å·å†…å®¹,é€šè¿‡huskyçš„commit-msgé’©å­,è°ƒç”¨commitlint
	pnpm i -D commitlint @commitlint/config-conventional

	//.husky/commit-msgä¸­
		#!/bin/sh  
		. "$(dirname "$0")/_/husky.sh"
		#!è°ƒç”¨commitlintæ ¡éªŒæäº¤æ ¼å¼
		npx commitlint --edit
	//åœ¨commitlint.config.jsä¸­æ·»åŠ 
	export default {  
	  "extends": [  
	   "@commitlint/config-conventional"  
	  ]  
	}
	//è‡ªå®šä¹‰æäº¤æ¶ˆæ¯æ ¼å¼
		//åœ¨commitlint.config.jsä¸­æ·»åŠ 
		//ä»¥ä¸‹è‡ªå®šä¹‰äº†ä¸€ä¸ªå«commit-message-ruleçš„æœ¬åœ°æ’ä»¶,å¹¶åœ¨rulesä¸­å®šä¹‰äº†å®ƒçš„ä½¿ç”¨èŒƒå›´
		
		export default {
		  //extends: ['@commitlint/config-conventional'],
		  //æ˜¯å¦ä½¿ç”¨é»˜è®¤å¿½ç•¥è§„åˆ™
		  //defaultIgnores: true,
		  // ä»€ä¹ˆæ¡ä»¶å¿½ç•¥æäº¤ä¿¡æ¯
		  ignores: [(commit) => commit.includes('init')],
		  //æäº¤éªŒè¯å¤±è´¥æ—¶ï¼Œå°†æ˜¾ç¤ºæ­¤ URL
		  helpUrl: 'http://172.26.0.17:8090/pages/viewpage.action?pageId=66330',
		  // [è§„åˆ™åç§°]:[level, applicable, value]
		  // level æ ¡éªŒç­‰çº§
		      // 0 ç¦ç”¨
		      // 1 è­¦å‘Š
		      // 2 é”™è¯¯
		  // applicable è§„åˆ™åŒ¹é…æ¨¡å¼
		      // always æ­£åŒ¹é…
		      // never ååŒ¹é…
		      // value å‚æ•°å€¼
		  // è§„åˆ™å¯æ¥æ”¶å‚æ•°ï¼š
		  // è§„åˆ™æ•°ç»„ Array
		  // è¿”å›è§„åˆ™æ•°ç»„çš„å‡½æ•° () => array
		  // Promiseè§„åˆ™æ•°ç»„ Promiseã€ŠArrayã€‹
		  rules: {
		    'commit-message-rule': [2, 'always'],
		  },
		  plugins: [
		    {
		      rules: {
		        'commit-message-rule': ({ header }) => {
		          // const noIssueReg = /[N|n][O|o][I|i][S|s][S|s][U|u][E|e]\;\s*[^\s]+\s*/;
		          const IssueReg = /\s*[I|i][S|s][S|s][U|u][E|e]\s*\:\s*[a-zA-Z]+-[0-9]+\s*\;[\s\S]*/;
		          return [IssueReg.test(header), 'æ‚¨çš„æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒï¼æ­£ç¡®çš„æ ¼å¼ä¸º(ç¤ºä¾‹)ï¼šIssue:xxxx-000;xxxxxx'];
		        },
		      },
		    },
		  ],
		};
	

-->6.å®‰è£…commitizenè¾…åŠ©æäº¤
	//éè‡ªå®šä¹‰
	npm i -g commitizen cz-conventional-changelog
	commitizen init cz-conventional-changelog --pnpm --save-dev --save-exact
	//è‡ªå®šä¹‰
	npm i -D commitizen cz-customizable
	//è‡ªå®šä¹‰è¾…åŠ©ä¿¡æ¯
		//å¢åŠ  .cz-config.js
		//`cz-customizable`Â Â ä¼šé¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æŸ¥æ‰¾åä¸ºÂ Â `.cz-config.js`Â Â æˆ–Â Â `.config/cz-config.js`Â Â çš„æ–‡ä»¶
		 
		   'use strict'
		  module.exports = {
		    types: [
		      { value: 'âœ¨æ–°å¢', name: 'æ–°å¢:    æ–°çš„å†…å®¹' },
		      { value: 'ğŸ›ä¿®å¤', name: 'ä¿®å¤:    ä¿®å¤ä¸€ä¸ªBug' },
		      { value: 'ğŸ“æ–‡æ¡£', name: 'æ–‡æ¡£:    å˜æ›´çš„åªæœ‰æ–‡æ¡£' },
		      { value: 'ğŸ’„æ ¼å¼', name: 'æ ¼å¼:    ç©ºæ ¼, åˆ†å·ç­‰æ ¼å¼ä¿®å¤' },
		      { value: 'â™»ï¸é‡æ„', name: 'é‡æ„:    ä»£ç é‡æ„ï¼Œæ³¨æ„å’Œç‰¹æ€§ã€ä¿®å¤åŒºåˆ†å¼€' },
		      { value: 'âš¡ï¸æ€§èƒ½', name: 'æ€§èƒ½:    æå‡æ€§èƒ½' },
		      { value: 'âœ…æµ‹è¯•', name: 'æµ‹è¯•:    æ·»åŠ ä¸€ä¸ªæµ‹è¯•' },
		      { value: 'ğŸ”§å·¥å…·', name: 'å·¥å…·:    å¼€å‘å·¥å…·å˜åŠ¨(æ„å»ºã€è„šæ‰‹æ¶å·¥å…·ç­‰)' },
		      { value: 'âªå›æ»š', name: 'å›æ»š:    ä»£ç å›é€€' }
		    ],
		    //æŒ‡å®šç”Ÿæ•ˆçš„æ–‡ä»¶ç±»å‹
		    scopes: [
		      { name: 'leetcode' },
		      { name: 'javascript' },
		      { name: 'typescript' },
		      { name: 'Vue' },
		      { name: 'node' }
		    ],
		    //ä»€ä¹ˆgitå‘½ä»¤ä¸æ‰§è¡Œscoped
		    scopeOverrides: {
		      fix: [
		        {name: 'merge'},
		        {name: 'style'},
		        {name: 'e2eTest'},
		        {name: 'unitTest'}
		      ]
		    },
		    // æ¶ˆæ¯
		    messages: {
		      type: 'é€‰æ‹©ä¸€ç§ä½ çš„æäº¤ç±»å‹:',
		      scope: 'é€‰æ‹©ä¸€ä¸ªscope (å¯é€‰):',
		      // used if allowCustomScopes is true
		      customScope: 'Denote the SCOPE of this change:',
		      subject: 'çŸ­è¯´æ˜:\n',
		      body: 'é•¿è¯´æ˜ï¼Œä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰)ï¼š\n',
		      breaking: 'éå…¼å®¹æ€§è¯´æ˜ (å¯é€‰):\n',
		      footer: 'å…³è”å…³é—­çš„issueï¼Œä¾‹å¦‚ï¼š#31, #34(å¯é€‰):\n',
		      confirmCommit: 'ç¡®å®šæäº¤è¯´æ˜?(yes/no)'
		    },
		    allowCustomScopes: true,
		    allowBreakingChanges: ['ç‰¹æ€§', 'ä¿®å¤'],
		    // limit subject length
		    subjectLimit: 100
		  }
```

## ç»Ÿä¸€ä»£ç é£æ ¼

- é…ç½®**Stylelint**å¯æŸ¥çœ‹[Stylelintè§„åˆ™](https://link.juejin.cn/?target=https%3A%2F%2Fstylelint.io%2Fuser-guide%2Frules%2Flist)
- é…ç½®**Eslint**å¯æŸ¥çœ‹[Eslintè§„åˆ™](https://link.juejin.cn/?target=https%3A%2F%2Feslint.org%2Fdocs%2Frules)
- é…ç½®**TypeScriptEslint**å¯æŸ¥çœ‹[TypeScriptEslintè§„åˆ™](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Ftypescript-eslint%2Ftypescript-eslint%2Fblob%2Fmaster%2Fpackages%2Feslint-plugin%2FREADME.md)
- é…ç½®**VueEslint**å¯æŸ¥çœ‹[VueEslintè§„åˆ™](https://link.juejin.cn/?target=https%3A%2F%2Feslint.vuejs.org%2Frules)
åº”ç”¨ä»£ç è§„èŒƒæœ‰ä¸‰ç‚¹å¥½å¤„ï¼š
- å¼ºåˆ¶è§„èŒƒå›¢é˜Ÿç¼–ç è§„èŒƒå¯è®©æ–°æ—§æˆå‘˜ç¼–ç ä¹ æƒ¯ä¸€æ ·
- å¢åŠ é¡¹ç›®ä»£ç çš„å¯ç»´æŠ¤æ€§ä¸å¯æ¥å…¥æ€§ï¼Œæ–°æˆå‘˜èƒ½å¿«é€Ÿé€‚åº”é¡¹ç›®çš„æ¶æ„ä¸éœ€æ±‚
- ä¿éšœé¡¹ç›®æ•´ä½“è´¨é‡ï¼Œå¯å‡å°‘æ— ç”¨ä»£ç ã€é‡å¤ä»£ç ã€é”™è¯¯ä»£ç å’Œæ¼æ´ä»£ç çš„äº§ç”Ÿå‡ ç‡

**Lint**å…¶å®å°±æ˜¯ç¼–è¾‘å™¨ä¸­è¿è¡Œçš„ä¸€ä¸ªè„šæœ¬è¿›ç¨‹ï¼Œå°†ä»£ç è§£æä¸º**æŠ½è±¡è¯­æ³•æ ‘(AST)**ï¼Œ

éå†**æŠ½è±¡è¯­æ³•æ ‘**å¹¶é€šè¿‡é¢„è®¾è§„åˆ™åšä¸€äº›åˆ¤æ–­ä¸æ”¹åŠ¨ï¼Œ

å†å°†æ–°çš„**æŠ½è±¡è¯­æ³•æ ‘**è½¬æ¢ä¸ºæ­£ç¡®ä»£ç ã€‚

**å¯ä»¥è€ƒè™‘å°†é…ç½®æ–‡ä»¶æ‰“åŒ…ä¸ºä¸€ä¸ªnpmåŒ…,ä¸‹ä¸‹æ¥åæœ¬åœ°å¼•ç”¨é…ç½®,æˆ–è€…ç¼–è¾‘å™¨é…ç½®**
### eslint
```javascript
//eslint-config-airbnb-base //(æ›´ä¸¥æ ¼,æ¨è)æä¾›airbnbé£æ ¼çš„ä»£ç è§„èŒƒ
//eslint-config-standard    //(ç›¸å¯¹å®½æ¾)æä¾›standardé£æ ¼çš„ä»£ç è§„èŒƒ
//eslint-plugin-import      //ç”¨äºæ£€æŸ¥ ES6 çš„ import/export è¯­æ³•
//eslint-plugin-vue         //å¸®åŠ©æ£€æŸ¥ Vue ç‰¹æœ‰çš„è¯­æ³•å’Œæœ€ä½³å®è·µ
//vite-plugin-eslint        //åœ¨ Vite æ„å»ºè¿‡ç¨‹ä¸­é›†æˆ ESLint,è‡ªåŠ¨æ‰§è¡Œä»£ç æ£€æŸ¥

//ä¿å­˜è‡ªåŠ¨æ ¼å¼åŒ–
//@vue/cli-plugin-eslint    //Â Vue CLIçš„ä¸€ä¸ªæ’ä»¶,ç”¨è¿™ä¸ªvuecliä¼šæ”¯æŒlintOnSaveé€‰é¡¹,åŒæ—¶ä¼šå®‰è£…eslintåŠå…¶ç›¸å…³ä¾èµ–
//vue2
npm i -D eslint@8.57.0 eslint-plugin-import eslint-plugin-vue eslint-config-airbnb-base
//vue3
npm i -D eslint@8.57.0 eslint-plugin-import eslint-plugin-vue vite-plugin-eslint eslint-config-airbnb-base

//react
npm i -D eslint@8.57.0 eslint-plugin-import eslint-plugin-react vite-plugin-eslint eslint-config-airbnb-base
```

### stylelint
æ ¡éªŒæ ·å¼é—®é¢˜

```javascript
//stylelint                         //CSS/SCSS/Lessä»£ç æ£€æŸ¥å·¥å…·
    //stylelint-config-recess-order     //è§„å®šcsså±æ€§çš„ä¹¦å†™é¡ºåº(è¦æŠ˜ç£¨è‡ªå·±å—?)

    //stylelint-config-standard         //Stylelint çš„æ ‡å‡†é…ç½®,åŒ…å«äº†ä¸€ç»„å¸¸è§çš„ CSS ç¼–ç æœ€ä½³å®è·µã€‚
    //stylelint-config-standard-vue     //åœ¨ stylelint-config-standard çš„åŸºç¡€ä¸Šæ–°å¢äº†ä¸€äº› Vue ç‰¹æœ‰çš„è§„åˆ™
    //stylelint-config-standard-scss    //åœ¨ stylelint-config-standard çš„åŸºç¡€ä¸Šæ–°å¢äº†stylelint-config-recommended-scssçš„å¤§éƒ¨åˆ†è§„åˆ™,åŒæ—¶é€‚åº”ä¸sass    
    //stylelint-config-standard-less    //åœ¨ stylelint-config-standard çš„åŸºç¡€ä¸Šæ–°å¢äº†stylelint-config-recommended-lessçš„å¤§éƒ¨åˆ†è§„åˆ™
    
    //stylelint-config-sass-guidelines  //åŒ…å«äº†ä¸€ç»„é’ˆå¯¹ ä»…sass çš„æœ€ä½³å®è·µè§„åˆ™
    //stylelint-config-recommended-scss //åŒ…å«äº†ä¸€ç»„é’ˆå¯¹ ä»…SCSS çš„æœ€ä½³å®è·µè§„åˆ™
    //stylelint-config-recommended-less //åŒ…å«äº†ä¸€ç»„é’ˆå¯¹ ä»…less çš„æœ€ä½³å®è·µè§„åˆ™

//ä»…css
npm i -D stylelint  stylelint-config-standard
â€‹//css sass scss
npm i -D stylelint  stylelint-config-standard stylelint-config-standard-scss
//css sass scss less
npm i -D stylelint  stylelint-config-standard stylelint-config-standard-scss stylelint-config-standard-less

//åŒ…å«vue
npm i -D stylelint-config-standard-vue
```

## ç»Ÿä¸€æäº¤è§„èŒƒ

```js
//husky                            //æ“ä½œ git é’©å­çš„å·¥å…·
//lint-staged                      //æœ¬åœ°æš‚å­˜ä»£ç æ£€æŸ¥å·¥å…·
//commitlint                       //commit ä¿¡æ¯æ ¡éªŒå·¥å…·
//@commitlint/config-conventional  //æä¾›ä¸€äº›é»˜è®¤é…ç½®
//commitizen                       //è¾…åŠ© commit ä¿¡æ¯ ,å°±åƒè¿™æ ·,é€šè¿‡é€‰æ‹©è¾“å…¥,è§„èŒƒæäº¤ä¿¡æ¯

//å…¨éƒ¨éƒ½è¦
	pnpm install -D husky lint-staged commitlint @commitlint/config-conventional commitizen
	npx mrm@2 lint-staged

```

### husky&lint-staged

huskyæ“ä½œ git é’©å­çš„å·¥å…·,å¸¸è§é’©å­å¦‚ä¸‹ï¼š
- pre-commit   æäº¤å‰çš„é’©å­
- commit-msg æäº¤ä¿¡æ¯é’©å­
- pre-push       pushå‰çš„é’©å­
lint-staged : æœ¬åœ°æš‚å­˜ä»£ç æ£€æŸ¥å·¥å…·
```javascript
//æ­¤å‘½ä»¤å°†æ ¹æ®é¡¹ç›®Â Â `package.json`Â Â ä¾èµ–é¡¹ä¸­çš„ä»£ç è´¨é‡å·¥å…·å®‰è£…å¹¶é…ç½® husky å’Œ lint-stagedï¼Œå› æ­¤è¯·ç¡®ä¿åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰å®‰è£…ï¼ˆÂ `npm install --save-dev`Â ï¼‰å¹¶é…ç½®æ‰€æœ‰ä»£ç è´¨é‡å·¥å…·ï¼Œä¾‹å¦‚ Prettier å’Œ ESLintã€‚
npx mrm@2 lint-staged
```

```javascript

//æ ¹ç›®å½•åˆ›å»º.lintstagedrc.jsonÂ æ–‡ä»¶æˆ–åœ¨package.jsonä¸­æ·»åŠ lint-stagedé…ç½®é¡¹ æ·»åŠ ä»¥ä¸‹ä»£ç 
{  
  "*.{js,jsx,ts,tsx,vue,md}": [  
   "eslint --fix",  
   "prettier --write"  
  ],  
  "*.{css,scss,less,jsx,tsx,vue}": [  
   "stylelint --cache --fix --cache-location node_modules/.cache/stylelint/"  
  ]  
}
```

### commitlint

- **commitlintï¼š**commit ä¿¡æ¯æ ¡éªŒå·¥å…·

- **@commitlint/config-conventional**ï¼šæä¾›ä¸€äº›é»˜è®¤é…ç½®,æ ‡è¯†é‡‡ç”¨ä»€ä¹ˆè§„èŒƒæ¥æ‰§è¡Œæ¶ˆæ¯æ ¡éªŒ, é»˜è®¤æ˜¯**Angular**çš„æäº¤è§„èŒƒ

```javascript
pnpm i -D commitlint @commitlint/config-conventional

	//åœ¨ pre-commitçš„é’©å­ä¸­,æ·»åŠ npx commitlint --edit,æ”¾åœ¨npx lint-stagedä¹‹å‰
	
	//åœ¨commitlint.config.jsä¸­æ·»åŠ 
	export default {  
	  "extends": [  
	   "@commitlint/config-conventional"  
	  ]  
	}    
```

[@commitlint/config-conventional](https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional)
**æ³¨æ„è¦åŠ ç©ºæ ¼**

æä¾›**Angular**æäº¤è§„èŒƒ

`<type>(<scope>): <short description>`
`[optional body]`
`[optional footer(s)]`

```javascript
//å¦‚éœ€ä¿®æ”¹@commitlint/config-conventionalçš„é»˜è®¤é…ç½®,çœ‹è‡ªå®šä¹‰æäº¤è§„èŒƒ,ç”¨è‡ªå®šä¹‰çš„è¦†ç›–å®ƒ

//æ·»åŠ commitlint.config.jsæˆ–.commitlintrc.js
module.exports = {
    extends: ['@commitlint/config-conventional'],
}
//æˆ–è€…åœ¨package.jsonä¸­æ·»åŠ 
"commitlint": {
    "extends": ["@commitlint/config-conventional"]
}
```

| ç±»å‹       | æè¿°                          |
| -------- | --------------------------- |
| feat     | æ–°å¢åŠŸèƒ½ï¼Œè¿­ä»£é¡¹ç›®éœ€æ±‚                 |
| refactor | é‡æ„ä»£ç ï¼Œéæ–°å¢åŠŸèƒ½ä¹Ÿéä¿®å¤ç¼ºé™·            |
| perf     | ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ              |
| test     | æ–°å¢æµ‹è¯•ï¼Œè¿½åŠ æµ‹è¯•ç”¨ä¾‹éªŒè¯ä»£ç              |
| style    | ä»£ç æ ¼å¼ä¿®æ”¹, æ³¨æ„ä¸æ˜¯ css ä¿®æ”¹         |
| fix      | ä¿®å¤ç¼ºé™·                        |
|          |                             |
| revert   | å›æ»šç‰ˆæœ¬ï¼Œæ’¤é”€æŸæ¬¡ä»£ç æäº¤               |
| merge    | åˆå¹¶åˆ†æ”¯ï¼Œåˆå¹¶åˆ†æ”¯ä»£ç åˆ°å…¶ä»–åˆ†æ”¯            |
|          |                             |
| docs     | æ›´æ–°æ–‡æ¡£ï¼Œä»…ä¿®æ”¹æ–‡æ¡£ä¸ä¿®æ”¹ä»£ç              |
| build    | ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨ |
| chore    | å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰  |
|          |                             |
| ci       | æ›´æ–°è„šæœ¬ï¼Œæ”¹åŠ¨CIæˆ–æ‰§è¡Œè„šæœ¬é…ç½®            |


#### è‡ªå®šä¹‰æäº¤è§„èŒƒ

é»˜è®¤æäº¤è§„èŒƒ `<type>(<scope>): <subject>`

[commitlintä¸­æ–‡æ–‡æ¡£](https://blog.csdn.net/qq_21197033/article/details/128609033)

å¦‚æœè‡ªå®šä¹‰æäº¤ä¿¡æ¯æ ¡éªŒå°±ä¸éœ€è¦[@commitlint/config-conventional](https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint/config-conventional)

[commitlint](https://commitlint.js.org/reference/plugins.html)å¯ä»¥å£°æ˜æœ¬åœ°æ’ä»¶,ä½†æ˜¯åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæœ¬åœ°æ’ä»¶

```javascript
//æ·»åŠ commitlint.config.jsæˆ–.commitlintrc.js
//ä»¥ä¸‹è‡ªå®šä¹‰äº†ä¸€ä¸ªå«commit-message-ruleçš„æœ¬åœ°æ’ä»¶,å¹¶åœ¨rulesä¸­å®šä¹‰äº†å®ƒçš„ä½¿ç”¨èŒƒå›´

module.exports = {
  //extends: ['@commitlint/config-conventional'],
  //æ˜¯å¦ä½¿ç”¨é»˜è®¤å¿½ç•¥è§„åˆ™
  //defaultIgnores: true,
  // ä»€ä¹ˆæ¡ä»¶å¿½ç•¥æäº¤ä¿¡æ¯
  ignores: [(commit) => commit.includes('init')],
  //æäº¤éªŒè¯å¤±è´¥æ—¶ï¼Œå°†æ˜¾ç¤ºæ­¤ URL
  helpUrl: 'http://172.26.0.17:8090/pages/viewpage.action?pageId=66330',
  // [è§„åˆ™åç§°]:[level, applicable, value]
  // level æ ¡éªŒç­‰çº§
      // 0 ç¦ç”¨
      // 1 è­¦å‘Š
      // 2 é”™è¯¯
  // applicable è§„åˆ™åŒ¹é…æ¨¡å¼
      // always æ­£åŒ¹é…
      // never ååŒ¹é…
      // value å‚æ•°å€¼
  // è§„åˆ™å¯æ¥æ”¶å‚æ•°ï¼š
  // è§„åˆ™æ•°ç»„ Array
  // è¿”å›è§„åˆ™æ•°ç»„çš„å‡½æ•° () => array
  // Promiseè§„åˆ™æ•°ç»„ Promiseã€ŠArrayã€‹
  rules: {
    'commit-message-rule': [2, 'always'],
  },
  plugins: [
    {
      rules: {
        'commit-message-rule': ({ header }) => {
          // const noIssueReg = /[N|n][O|o][I|i][S|s][S|s][U|u][E|e]\;\s*[^\s]+\s*/;
          const IssueReg = /\s*[I|i][S|s][S|s][U|u][E|e]\s*\:\s*[a-zA-Z]+-[0-9]+\s*\;[\s\S]*/;
          return [IssueReg.test(header), 'æ‚¨çš„æäº¤ä¿¡æ¯ä¸ç¬¦åˆè§„èŒƒï¼æ­£ç¡®çš„æ ¼å¼ä¸º(ç¤ºä¾‹)ï¼šIssue:xxxx-000;xxxxxx'];
        },
      },
    },
  ],
};

```

### commitizen

è¾…åŠ© commit ä¿¡æ¯,åªæ”¯æŒæ‰‹åŠ¨è¾“å…¥git czå‘½ä»¤è§¦å‘

```javascript
//cz-conventional-changelog æä¾›é»˜è®¤çš„git czæç¤º
//cz-customizable           è‡ªå®šä¹‰git czçš„æç¤º
npm i -D commitizen cz-customizable

//æŒ‡å®špackage.jsonä¸­ config/commitizen/path ä¸º"./node_modules/cz-customizable"
"config": {
  "commitizen": {
    "path": "node_modules/cz-customizable"
  }
}
```

#### è‡ªå®šä¹‰czä¿¡æ¯

```javascript
//`cz-customizable`Â Â ä¼šé¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æŸ¥æ‰¾åä¸ºÂ Â `.cz-config.js`Â Â æˆ–Â Â `.config/cz-config.js`Â Â çš„æ–‡ä»¶
 //å¢åŠ  .cz-config.js
   'use strict'
  module.exports = {
    types: [
      { value: 'âœ¨æ–°å¢', name: 'æ–°å¢:    æ–°çš„å†…å®¹' },
      { value: 'ğŸ›ä¿®å¤', name: 'ä¿®å¤:    ä¿®å¤ä¸€ä¸ªBug' },
      { value: 'ğŸ“æ–‡æ¡£', name: 'æ–‡æ¡£:    å˜æ›´çš„åªæœ‰æ–‡æ¡£' },
      { value: 'ğŸ’„æ ¼å¼', name: 'æ ¼å¼:    ç©ºæ ¼, åˆ†å·ç­‰æ ¼å¼ä¿®å¤' },
      { value: 'â™»ï¸é‡æ„', name: 'é‡æ„:    ä»£ç é‡æ„ï¼Œæ³¨æ„å’Œç‰¹æ€§ã€ä¿®å¤åŒºåˆ†å¼€' },
      { value: 'âš¡ï¸æ€§èƒ½', name: 'æ€§èƒ½:    æå‡æ€§èƒ½' },
      { value: 'âœ…æµ‹è¯•', name: 'æµ‹è¯•:    æ·»åŠ ä¸€ä¸ªæµ‹è¯•' },
      { value: 'ğŸ”§å·¥å…·', name: 'å·¥å…·:    å¼€å‘å·¥å…·å˜åŠ¨(æ„å»ºã€è„šæ‰‹æ¶å·¥å…·ç­‰)' },
      { value: 'âªå›æ»š', name: 'å›æ»š:    ä»£ç å›é€€' }
    ],
    //æŒ‡å®šç”Ÿæ•ˆçš„æ–‡ä»¶ç±»å‹
    scopes: [
      { name: 'leetcode' },
      { name: 'javascript' },
      { name: 'typescript' },
      { name: 'Vue' },
      { name: 'node' }
    ],
    //ä»€ä¹ˆgitå‘½ä»¤ä¸æ‰§è¡Œscoped
    scopeOverrides: {
      fix: [
        {name: 'merge'},
        {name: 'style'},
        {name: 'e2eTest'},
        {name: 'unitTest'}
      ]
    },
    // æ¶ˆæ¯
    messages: {
      type: 'é€‰æ‹©ä¸€ç§ä½ çš„æäº¤ç±»å‹:',
      scope: 'é€‰æ‹©ä¸€ä¸ªscope (å¯é€‰):',
      // used if allowCustomScopes is true
      customScope: 'Denote the SCOPE of this change:',
      subject: 'çŸ­è¯´æ˜:\n',
      body: 'é•¿è¯´æ˜ï¼Œä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰)ï¼š\n',
      breaking: 'éå…¼å®¹æ€§è¯´æ˜ (å¯é€‰):\n',
      footer: 'å…³è”å…³é—­çš„issueï¼Œä¾‹å¦‚ï¼š#31, #34(å¯é€‰):\n',
      confirmCommit: 'ç¡®å®šæäº¤è¯´æ˜?(yes/no)'
    },
    allowCustomScopes: true,
    allowBreakingChanges: ['ç‰¹æ€§', 'ä¿®å¤'],
    // limit subject length
    subjectLimit: 100
  }

```

# é¡¹ç›®ç®¡ç†
## CI/CD

gitlabæä¾›äº† CI/CDåŠŸèƒ½ï¼Œgitlab-ci.yml æ–‡ä»¶æ˜¯ GitLab CI/CD é…ç½®çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œå¸¸è§é…ç½®å¦‚ä¸‹ï¼š

1. stagesï¼šå®šä¹‰äº†æµæ°´çº¿çš„ä¸åŒé˜¶æ®µ(ä½œä¸š)ï¼ŒæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚
2. variablesï¼šå®šä¹‰äº†å…¨å±€å˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥åœ¨æ•´ä¸ª gitlab-ci.yml æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚
3. before_scriptï¼šåœ¨æ¯ä¸ªä½œä¸šä¹‹å‰è¿è¡Œçš„å‘½ä»¤ã€‚
4. jobs(å¯ä¸æ˜¾ç¤ºå£°æ˜,æ»¡è¶³jobç»“æ„çš„é…ç½®é¡¹ä¼šè‡ªåŠ¨è¯†åˆ«ä¸ºjob)ï¼šå®šä¹‰æ¯ä¸ªä½œä¸šåšçš„äº‹æƒ…ï¼Œè¿™é‡Œbuild_jobä½œä¸šå°±æ˜¯å®šä¹‰buildé˜¶æ®µåšçš„äº‹æƒ…ã€‚
	1. stageï¼šå®šä¹‰è¿™ä¸ªä½œä¸šå¯¹åº”çš„æµæ°´çº¿é˜¶æ®µ
	2. artifactsï¼šç”¨äºå®šä¹‰æ„å»ºäº§ç‰©ï¼Œå¯ä»¥åœ¨åç»­é˜¶æ®µæˆ–ä½œä¸šä¸­ä½¿ç”¨ã€‚
		1. pathsï¼šæ„å»ºäº§ç‰©æ‰€åœ¨ç›®å½•
	3. cacheï¼šç¼“å­˜ä¾èµ–é¡¹æˆ–æ„å»ºç»“æœï¼Œä»¥åŠ å¿«åç»­çš„æ„å»ºé€Ÿåº¦ã€‚
		1. keyï¼š
			1. keyç›¸å½“äºç»™ç¼“å­˜å‘½åˆ«åï¼Œç¼“å­˜ç©ºé—´å…·æœ‰è¿™ä¸ªåå­—çš„ç¼“å­˜å°±ä¼šä½¿ç”¨ç¼“å­˜
			2. é»˜è®¤æ˜¯defaultï¼Œæ‰€æœ‰æœªæŒ‡å®šç¼“å­˜é”®çš„jobå°†å…±äº«åŒä¸€ä¸ªç¼“å­˜ç©ºé—´
		2. policyï¼šé»˜è®¤ pull-push è¡¨ç¤ºå…ˆæ¢å¤ç¼“å­˜ï¼Œç„¶åæ›´æ–°ç¼“å­˜
		3. pathsï¼šåº”è¯¥ç¼“å­˜çš„ç›®å½•
	4. dependenciesï¼šå®šä¹‰ä½œä¸šä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªä½œä¸šä¾èµ–å“ªä¸ªä½œä¸šã€‚
	5. servicesï¼šä¸ºä½œä¸šæä¾›è¾…åŠ©æœåŠ¡ï¼Œå¦‚æ•°æ®åº“æœåŠ¡ã€‚

```sh
cache:
	paths:  
	  - node_modules/     #node_modulesç›®å½•ç¼“å­˜èµ·æ¥
#å®šä¹‰äº†ä½œä¸šï¼ˆjobsï¼‰æ‰§è¡Œçš„é¡ºåº
stages: #æµæ°´è¿‡ç¨‹ï¼Œå…ˆä»build-->deploy  
  - build
  - deploy

#å®šä¹‰çš„å…¨å±€å˜é‡
variables:
	DEFAULT_BRANCH: dev-prd  
	NAGINX_PATH: /data/middle/base-env/nginx/html/ts-cloud-web-all  
	IP: 192.168.18.130

#å‰ç½®è„šæœ¬ï¼Œæ¯ä¸ªä½œä¸šæ‰§è¡Œå‰éƒ½ä¼šè°ƒç”¨çš„è„šæœ¬
before_script:  
- echo "Setting up the environment..."

npm-build: # è‡ªå®šä¹‰çš„ä½œä¸šåç§°
	stage: build # æŒ‡å®šè¿™ä¸ªä½œä¸šå±äºå“ªä¸ªé˜¶æ®µ
	tags: - 'npm-14' # æŒ‡å®šä½¿ç”¨å“ªä¸ªGitLab Runneræ¥æ‰§è¡Œè¿™ä¸ªä½œä¸šï¼ˆé€šè¿‡Runnerçš„tagï¼‰ 
	script: # å®šä¹‰äº†ä¸€ç³»åˆ—è¦æ‰§è¡Œçš„å‘½ä»¤
		- . /root/.nvm/nvm-0.39.3/nvm.sh # åŠ è½½NVMè„šæœ¬ï¼Œä»¥ä¾¿èƒ½å¤Ÿåˆ‡æ¢Node.jsç‰ˆæœ¬
		- nvm use 18.18.0 # ä½¿ç”¨NVMåˆ‡æ¢åˆ°Node.js 18.18.0ç‰ˆæœ¬
		- pnpm install # ä½¿ç”¨pnpmå®‰è£…é¡¹ç›®ä¾èµ–
		- pnpm run build:prod # æ‰§è¡Œpnpmè„šæœ¬ä¸­å®šä¹‰çš„build:prodå‘½ä»¤æ¥æ„å»ºç”Ÿäº§ç¯å¢ƒçš„ä»£ç 
	# å®šä¹‰ä½œä¸šæ‰§è¡Œåéœ€è¦ä¿ç•™çš„æ–‡ä»¶æˆ–ç›®å½•
	artifacts:
		paths:
			- dist/ # æŒ‡å®šè¦ä¿ç•™çš„ç›®å½•ä¸ºdist/ï¼Œè¿™é€šå¸¸åŒ…å«æ„å»ºåçš„äº§ç‰©
	rules:  
		- if: '$CI_COMMIT_BRANCH == $DEFAULT_BRANCH'  
		- when: always  
		- when: never
	#only: - dev # åªæœ‰å½“åœ¨æŒ‡å®šåˆ†æ”¯ä¸Šæäº¤æ›´æ”¹æ—¶ï¼Œè¿™ä¸ªä½œä¸šæ‰ä¼šè¢«è§¦å‘
npm-deploy:
	#ä¾èµ–å“ªäº›ä½œä¸šçš„è¾“å‡º
	#dependencies: [build_job]
	stage: deploy # æŒ‡å®šè¿™ä¸ªä½œä¸šå±äºdeployé˜¶æ®µ
	tags: - 'npm-deploy' # æŒ‡å®šä½¿ç”¨å“ªä¸ªGitLab Runneræ¥æ‰§è¡Œè¿™ä¸ªä½œä¸šï¼ˆé€šè¿‡Runnerçš„tagï¼‰
	script:
	 	  # å®šä¹‰å˜é‡current_dateï¼Œå­˜å‚¨å½“å‰æ—¶é—´ï¼ˆå¹´-æœˆ-æ—¥-æ—¶-åˆ†-ç§’ï¼‰
		- current_date=$(date +"%Y-%m-%d-%H-%M-%S")
		# æ‰“å°å½“å‰æ—¥æœŸå’Œæ—¶é—´
		- echo $current_date
		# é€šè¿‡SSHç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä»¥å½“å‰æ—¥æœŸå’Œæ—¶é—´å‘½åçš„å¤‡ä»½ç›®å½•
		- ssh root@$IP "mkdir $NAGINX_PATH/ts-cloud-web_bak/$current_date"
		# æ£€æŸ¥ç›®æ ‡ç›®å½•æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™å°†æ—§çš„æ–‡ä»¶ç§»åŠ¨åˆ°å‰é¢åˆ›å»ºçš„å¤‡ä»½ç›®å½•ä¸­
		- ssh root@$IP "if du -sh '$NAGINX_PATH/ts-cloud-web' | grep -q '0\b'; then echo 'empty'; else mv -f '$NAGINX_PATH/ts-cloud-web'/* '$NAGINX_PATH/ts-cloud-web_bak/$current_date'; fi"
		# ä½¿ç”¨SCPå‘½ä»¤å°†æ„å»ºå¥½çš„distç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ç›®æ ‡ç›®å½•ä¸­
		- scp -r dist/* root@192.168.18.130:/data/middle/base-env/nginx/html/ts-cloud-web-all/ts-cloud-web
	rules:  
	  - if: '$CI_COMMIT_BRANCH == $DEFAULT_BRANCH'  
	  - when: always  
	  - when: never
	#only: - dev # åªæœ‰å½“åœ¨æŒ‡å®šåˆ†æ”¯ä¸Šæäº¤æ›´æ”¹æ—¶ï¼Œè¿™ä¸ªä½œä¸šæ‰ä¼šè¢«è§¦å‘
```

## åˆ‡æ¢Npmé•œåƒ

npm i nrm -g

| å‘½ä»¤                     | åŠŸèƒ½     |
| ---------------------- | ------ |
| nrm add `<name> <url>` | æ–°å¢é•œåƒ   |
| nrm del `<name>`       | åˆ é™¤é•œåƒ   |
| nrm test `<name>`      | æµ‹è¯•é•œåƒ   |
| nrm use `<name>`       | åˆ‡æ¢é•œåƒ   |
| nrm current            | æŸ¥çœ‹é•œåƒ   |
| nrm ls                 | æŸ¥çœ‹é•œåƒåˆ—è¡¨ |


## åˆ‡æ¢nodeç‰ˆæœ¬

npm i nvm -g

| å‘½ä»¤                        | åŠŸèƒ½            |
| ------------------------- | ------------- |
| nvm ls                    | æŸ¥çœ‹æœ¬åœ°nodeç‰ˆæœ¬åˆ—è¡¨  |
| nvm use `<version>`       | åˆ‡æ¢ç‰ˆæœ¬          |
| nvm install `<version>`   | ä¸‹è½½ä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬çš„node |
| nvm uninstall `<version>` | å¸è½½ä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬çš„node |


## nodeæ”¯æŒESM

### æ¨¡å—æ–¹æ¡ˆ

åœ¨JSå‘å±•å†ç¨‹ä¸­ï¼Œä¸»è¦æœ‰å…­ç§å¸¸è§æ¨¡å—æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯IIFEã€CJSã€AMDã€CMDã€UMDå’ŒESMã€‚ä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ï¼Œé€šè¿‡ä¸‹å›¾å±•ç¤ºå®ƒä»¬å„è‡ªçš„å®šä¹‰ä¸ç‰¹æ€§ï¼š

![](images/WEBRESOURCEf6a4605bb702de4b7946aa074a0ff947æˆªå›¾.png)

### CJSä¸ESM

| -    | CJS                                 | ESM                            |
| ---- | ----------------------------------- | ------------------------------ |
| è¯­æ³•ç±»å‹ | åŠ¨æ€                                  | é™æ€                             |
| å…³é”®å£°æ˜ | require                             | exportä¸import                  |
| åŠ è½½æ–¹å¼ | è¿è¡Œæ—¶åŠ è½½                               | ç¼–è¯‘æ—¶åŠ è½½                          |
| åŠ è½½è¡Œä¸º | åŒæ­¥åŠ è½½                                | å¼‚æ­¥åŠ è½½                           |
| ä¹¦å†™ä½ç½® | ä»»ä½•ä½ç½®                                | é¡¶å±‚ä½ç½®                           |
| æŒ‡é’ˆæŒ‡å‘ | thisæŒ‡å‘**å½“å‰æ¨¡å—**                      | thisæŒ‡å‘**undefined**            |
| æ‰§è¡Œé¡ºåº | é¦–æ¬¡å¼•ç”¨æ—¶**åŠ è½½æ¨¡å—**<br>å†æ¬¡å¼•ç”¨æ—¶**è¯»å–ç¼“å­˜**      | å¼•ç”¨æ—¶ç”Ÿæˆ**åªè¯»å¼•ç”¨**<br>æ‰§è¡Œæ—¶æ‰æ˜¯**æ­£å¼å–å€¼** |
| å±æ€§å¼•ç”¨ | åŸºæœ¬ç±»å‹å±äº**å¤åˆ¶ä¸å…±äº«**<br>å¼•ç”¨ç±»å‹å±äº**æµ…æ‹·è´ä¸”å…±äº«** | æ‰€æœ‰                             |


- è¿è¡Œæ—¶åŠ è½½æŒ‡æ•´ä½“åŠ è½½æ¨¡å—ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œå†ä»å¯¹è±¡ä¸­è·å–æ‰€éœ€çš„å±æ€§æ–¹æ³•å»åŠ è½½ã€‚æœ€å¤§ç‰¹æ€§æ˜¯**å…¨éƒ¨åŠ è½½**ï¼Œåªæœ‰è¿è¡Œæ—¶æ‰èƒ½å¾—åˆ°è¯¥å¯¹è±¡ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶åšé™æ€ä¼˜åŒ–ã€‚

- ç¼–è¯‘æ—¶åŠ è½½æŒ‡ç›´æ¥ä»æ¨¡å—ä¸­è·å–æ‰€éœ€çš„å±æ€§æ–¹æ³•å»åŠ è½½ã€‚æœ€å¤§ç‰¹æ€§æ˜¯**æŒ‰éœ€åŠ è½½**ï¼Œåœ¨ç¼–è¯‘æ—¶å°±å®Œæˆæ¨¡å—åŠ è½½ï¼Œæ•ˆç‡æ¯”å…¶ä»–æ–¹æ¡ˆé«˜ï¼Œæ— æ³•å¼•ç”¨æ¨¡å—æœ¬èº«(**æœ¬èº«ä¸æ˜¯å¯¹è±¡**)ï¼Œä½†å¯æ‹“å±•JSé«˜çº§è¯­æ³•(**å®ä¸ç±»å‹æ ¡éªŒ**)ã€‚

### nodeå¯¹ESMçš„åŸç”Ÿæ”¯æŒ

2017å¹´10æœˆ31æ—¥ï¼Œ`Node` å‘å¸ƒäº†**v8.9.0**ï¼Œä»æ­¤åªè¦åœ¨å‘½ä»¤ä¸­åŠ ä¸Š `--experimental-modules`ï¼Œ`Node` å°±å¯è±¡å¾æ€§åœ°æ”¯æŒ `ESM` äº†

```bash
node --experimental-modules index.js

```

ä½† `ä½ç‰ˆæœ¬Node` ä¾ç„¶æ— æ³•ç›´æ¥æ”¯æŒ `ESM` è§£æï¼Œè¿˜éœ€åœ¨è¿è¡Œç¯å¢ƒä¸­â€œ**åšäº›æ‰‹è„š**â€æ‰è¡Œã€‚

æ¥ç€`Node`å‘å¸ƒäº†**v13.2.0**å¸¦æ¥ä¸€äº›æ–°ç‰¹æ€§ï¼Œæ­£å¼**å–æ¶ˆ--experimental-modules**å¯åŠ¨å‚æ•°ã€‚å½“ç„¶å¹¶ä¸æ˜¯åˆ é™¤--experimental-modulesï¼Œè€Œæ˜¯**åœ¨å…¶åŸæœ‰åŸºç¡€ä¸Šå®ç°å¯¹ESMçš„å®éªŒæ€§æ”¯æŒå¹¶é»˜è®¤å¯åŠ¨**ã€‚

--experimental-modulesç‰¹æ€§åŒ…æ‹¬ä»¥ä¸‹æ–¹é¢ã€‚

1. ä½¿ç”¨ `type` æŒ‡å®šæ¨¡å—æ–¹æ¡ˆ
	1. åœ¨ `package.json` ä¸­æŒ‡å®š `type` ä¸º `commonjs`ï¼Œåˆ™ä½¿ç”¨CJS
	2. åœ¨ `package.json` ä¸­æŒ‡å®š `type` ä¸º `module`ï¼Œåˆ™ä½¿ç”¨ESM
2. ä½¿ç”¨ `--input-type` æŒ‡å®šå…¥å£æ–‡ä»¶çš„æ¨¡å—æ–¹æ¡ˆï¼Œä¸ `type` ä¸€æ ·
	1. å‘½ä»¤ä¸­åŠ ä¸Š `--input-type=commonjs`ï¼Œåˆ™ä½¿ç”¨ `CJS`
	2. å‘½ä»¤ä¸­åŠ ä¸Š `--input-type=module`ï¼Œåˆ™ä½¿ç”¨ `ESM`
3. æ”¯æŒæ–°æ–‡ä»¶åç¼€ `.cjs`
	1. æ–‡ä»¶åç¼€ä½¿ç”¨ `.cjs`ï¼Œåˆ™ä½¿ç”¨ `CJS`
4. ä½¿ç”¨ `--es-module-specifier-resolution` æŒ‡å®šæ–‡ä»¶åç§°å¼•ç”¨æ–¹å¼
	- å‘½ä»¤ä¸­åŠ ä¸Š `--es-module-specifier-resolution=explicit`ï¼Œåˆ™å¼•ç”¨æ¨¡å—æ—¶å¿…é¡»ä½¿ç”¨æ–‡ä»¶åç¼€(é»˜è®¤)
	- å‘½ä»¤ä¸­åŠ ä¸Š `--es-module-specifier-resolution=node`ï¼Œåˆ™å¼•ç”¨æ¨¡å—æ—¶æ— éœ€ä½¿ç”¨æ–‡ä»¶åç¼€
- ä½¿ç”¨ `main` æ ¹æ® `type` æŒ‡å®šæ¨¡å—æ–¹æ¡ˆåŠ è½½æ–‡ä»¶
- åœ¨ `package.json` ä¸­æŒ‡å®š `mian` åä¼šæ ¹æ® `type` æŒ‡å®šæ¨¡å—æ–¹æ¡ˆåŠ è½½æ–‡ä»¶

### CJS/ESMåˆ¤æ–­æ–¹å¼

`Node`è¦æ±‚ä½¿ç”¨`ESM`çš„æ–‡ä»¶é‡‡ç”¨`.mjs`åç¼€ï¼Œåªè¦æ–‡ä»¶ä¸­å­˜åœ¨`import/export`å‘½ä»¤å°±å¿…é¡»ä½¿ç”¨`.mjs`åç¼€ã€‚è‹¥ä¸å¸Œæœ›ä¿®æ”¹æ–‡ä»¶åç¼€ï¼Œå¯åœ¨`package.json`ä¸­æŒ‡å®š`type`ä¸º`module`ã€‚åŸºäºæ­¤ï¼Œè‹¥å…¶ä»–æ–‡ä»¶ä½¿ç”¨`CJS`ï¼Œå°±éœ€å°†å…¶æ–‡ä»¶åç¼€æ”¹æˆ`.cjs`ã€‚è‹¥åœ¨`package.json`ä¸­æœªæŒ‡å®š`type`æˆ–æŒ‡å®š`type`ä¸º`commonjs`ï¼Œåˆ™ä»¥`.js`ä¸ºåç¼€çš„æ–‡ä»¶ä¼šè¢«è§£æä¸ºCJSã€‚

ç®€è€Œè¨€ä¹‹ï¼Œ`mjs`æ–‡ä»¶ä½¿ç”¨`ESM`è§£æï¼Œ`cjs`æ–‡ä»¶ä½¿ç”¨`CJS`è§£æï¼Œ`js`æ–‡ä»¶ä½¿ç”¨åŸºäº`package.json`æŒ‡å®šçš„`type`è§£æ
**(`type=commonjs`ä½¿ç”¨`CJS`ï¼Œ`type=module`ä½¿ç”¨`ESM`)**ã€‚

å½“ç„¶è¿˜å¯é€šè¿‡å‘½ä»¤å‚æ•°å¤„ç†ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºè¿™æ ·åšæ“ä½œè¿‡å¤šï¼Œæ‰€ä»¥å°±ä¸è®¨è®ºå…·ä½“æ–¹æ³•äº†ã€‚

åˆšæ‰è¯´äº† `Node v13.2.0` åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå¯åŠ¨å¯¹ `ESM` çš„å®éªŒæ”¯æŒï¼Œæ— éœ€åœ¨å‘½ä»¤ä¸­åŠ ä¸Š `--experimental-modules` å‚æ•°ã€‚é‚£ **Nodeæ˜¯å¦‚ä½•åŒºåˆ†CJSä¸ESM**ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œ**Nodeä¼šå°†ä»¥ä¸‹æƒ…å†µè§†ä¸ºESM**ã€‚

1. Â æ–‡ä»¶åç¼€ä¸º `.mjs`
2. Â æ–‡ä»¶åç¼€ä¸º `.js` ä¸”åœ¨ `package.jsonä¸­` æŒ‡å®š `type` ä¸º `module`
3. Â å‘½ä»¤ä¸­åŠ ä¸Š `--input-type=module`
4. Â å‘½ä»¤ä¸­åŠ ä¸Š `--eval cmd`

### esmä¸­å¦‚ä½•ä½¿ç”¨ `__dirname` å’Œ `__filename`

```javascript
import { dirname } from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
console.log(__filename, __dirname,import.meta.url);
```

ç¤ºä¾‹å¼•ç”¨æˆ‘å¼€æºçš„ [@yangzw/bruce-us](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FJowayYoung%2Fbruce%2Ftree%2Fmain%2Fpackages%2Fus)ï¼Œå…¶ä¸­ `NodeType()` ç”¨äºè·å– `Node` ç›¸å…³ä¿¡æ¯ã€‚

```js
import { NodeType } from "@yangzw/bruce-us/dist/node";

console.log(NodeType());
```

### æŸ¥çœ‹nodeå¯¹åº”çš„npmç‰ˆæœ¬

ä½¿ç”¨[Node Releases](https://link.juejin.cn/?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload%2Freleases)

### ä½ç‰ˆæœ¬nodeå…¼å®¹

è‹¥éœ€å…¼å®¹ `æ›´ä½ç‰ˆæœ¬Node`ï¼Œå¯åœ¨ `package.json` ä¸­æŒ‡å®š `babel` çš„ `targets`ã€‚

```javascript
{
    "babel": {
        "presets": [
            ["@babel/preset-env", { "targets": { "node": "8.0.0" } }]
        ]
    }
}

```

## æœåŠ¡ç®¡ç†

- nodemoné€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼Œè°ƒè¯•ä»£ç æ›´æ–¹ä¾¿ï¼›
- foreveré€‚ç”¨äºæ— éœ€ç›‘æ§ä¸”è®¿é—®é‡è¾ƒå°çš„NodeæœåŠ¡ï¼›
- pm2é€‚ç”¨äºéœ€ç›‘æ§ä¸”è®¿é—®é‡è¾ƒå¤§çš„NodeæœåŠ¡ï¼›

| å·¥å…·                                              | ç¨³å®šæ€§ | è¿è¡Œç¯å¢ƒ | å¹¶å‘é‡çº§ | åå°è¿è¡Œ | ä»£ç ç›‘å¬ | çŠ¶æ€ç›‘æ§ | æ—¥å¿—ç®¡ç† | é›†ç¾¤æ¨¡å¼ |
| ----------------------------------------------- | --- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| [nodemon](https://github.com/remy/nodemon)      | ä¸­ç­‰  | å¼€å‘ç¯å¢ƒ | æ—     | âŒ    | âœ”ï¸   | âŒ    | âŒ    | âŒ    |
| [forever](https://github.com/foreversd/forever) | ä¸­ç­‰  | ç”Ÿäº§ç¯å¢ƒ | è¾ƒå°   | âœ”ï¸   | âœ”ï¸   | âŒ    | âœ”ï¸   | âŒ    |
| [pm2](https://github.com/Unitech/pm2)           | è¾ƒé«˜  | ç”Ÿäº§ç¯å¢ƒ | è¾ƒå¤§   | âœ”ï¸   | âœ”ï¸   | âœ”ï¸   | âœ”ï¸   | âœ”ï¸   |


### pm2

pm2 æ˜¯nodeçš„ process manager(è¿›ç¨‹ç®¡ç†)çš„ç¬¬äºŒå¤§ç‰ˆæœ¬

ä¸»è¦åŠŸèƒ½æ˜¯**è¿›ç¨‹ç®¡ç†ã€æ—¥å¿—ç®¡ç†ã€è´Ÿè½½å‡è¡¡ã€æ€§èƒ½ç›‘æ§**ç­‰

npm install -g pm2

| å‘½ä»¤                                          | ä½œç”¨                                   |
| ------------------------------------------- | ------------------------------------ |
| pm2 ecosystem                               | åˆ›å»ºä¸€ä¸ªecosystem.config.jsæ–‡ä»¶,           |
| pm2 link xxx xxx                            | é“¾æ¥è¿œç¨‹app.pm2.ioç½‘ç«™åˆ›å»ºçš„bucket,ç”¨äºåœ¨çº¿ç›‘æ§     |
| pm2 logs/flush                              | æŸ¥çœ‹/æ¸…ç©ºæ—¥å¿—                              |
| pm2 logs/flush è¿›ç¨‹å/è¿›ç¨‹id                     | æŸ¥çœ‹/æ¸…ç©ºå•ä¸ªè¿›ç¨‹çš„æ—¥å¿—                         |
| pm2 list/stop/restart/delete all            | æŸ¥çœ‹/åœæ­¢/é‡å¯/åˆ é™¤æ‰€æœ‰è¿›ç¨‹                      |
| pm2 show/stop/restart/delete/monit è¿›ç¨‹id     | æŸ¥çœ‹å•ä¸ªè¿›ç¨‹çš„çŠ¶æ€                            |
| pm2 save/resurrect                          | ä¿å­˜/æ¢å¤è¿›ç¨‹çŠ¶æ€                            |
| pm2 scale åº”ç”¨ç¨‹åºå/id num/+num/-num            | åŠ¨æ€è°ƒæ•´è¿›ç¨‹æ•°,æŒ‡å®šä¸ªæ•°/æ–°å¢ä¸ªæ•°/å‡å°‘ä¸ªæ•°               |
| pm2 start è¿›ç¨‹æ–‡ä»¶è·¯å¾„                            | å¯åŠ¨è¿›ç¨‹                                 |
| pm2 start è¿›ç¨‹æ–‡ä»¶è·¯å¾„  --max-memory-restart 200M | å¯åŠ¨è¿›ç¨‹,å¹¶é™åˆ¶æœ€å¤§é‡å¯å†…å­˜ä¸º200m,è¶…å‡ºå°±è‡ªåŠ¨é‡å¯          |
| pm2 start app.js -i 0                       | æ ¹æ®CPUæ ¸æ•°å¯åŠ¨ç›¸åº”æ•°é‡çš„è¿›ç¨‹,0/maxè¡¨ç¤ºä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„CPUæ ¸å¿ƒ |


### nodemonè‡ªåŠ¨é‡å¯æœåŠ¡

ä½¿ç”¨ [nodemon](https://nodemon.io/), åœ¨ `package.jso` nä¸­æŒ‡å®š `nodemonConfig` ç›¸å…³é…ç½®ï¼Œå°† `start` å‘½ä»¤æ›¿æ¢ä¸º `nodemon -x babel-node src/index.js`ã€‚

```json
{
    "nodemonConfig": {
        "env": {
            "NODE_ENV": "dev"
        },
        "execMap": {
            "js": "node --harmony"
        },
        "ext": "js json",
        "ignore": [
            "dist/"
        ],
        "watch": [
            "src/"
        ]
    }
}
```
# å‰ç«¯éƒ¨ç½²

## nginx å‘½ä»¤

```java
./nginx #é»˜è®¤é…ç½®æ–‡ä»¶å¯åŠ¨
./nginx -t #æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®
./nginx -s reload #é‡å¯ï¼ŒåŠ è½½é»˜è®¤é…ç½®æ–‡ä»¶
./nginx -c /usr/local/nginx/conf/nginx.conf #å¯åŠ¨æŒ‡å®šæŸä¸ªé…ç½®æ–‡ä»¶
./nginx -s stop #åœæ­¢ #å…³é—­è¿›ç¨‹
```

## æ­£åå‘ä»£ç†

    æ­£å‘ä»£ç†(æœåŠ¡å™¨ä¸çŸ¥é“è¢«å“ªå°å®¢æˆ·ç«¯è®¿é—®):å®¢æˆ·ç«¯è®¿é—®ä»£ç†æœåŠ¡å™¨å¹¶å‘Šè¯‰å®ƒè¦è®¿é—®çš„ç›®æ ‡æœåŠ¡å™¨,ä»£ç†æœåŠ¡å™¨å¸®å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨

    åå‘ä»£ç†(å®¢æˆ·ç«¯ä¸çŸ¥é“è®¿é—®å“ªå°æœåŠ¡å™¨):å®¢æˆ·ç«¯è®¿é—®ä»£ç†æœåŠ¡å™¨,ä»£ç†æœåŠ¡å™¨æ ¹æ®ç­–ç•¥åŠ¨æ€é€‰æ‹©è®¿é—®çš„æœåŠ¡å™¨

## æŸ¥çœ‹ç”µè„‘ç«¯å£æ˜¯å¦è¢«å ç”¨

```java
netstat -ano | findStr 80 //cmdå‘½ä»¤,æŸ¥æ‰¾80ç«¯å£è¿›ç¨‹
```

## nginx æ–‡ä»¶ç»“æ„

nginx å®‰è£…ç›®å½•é€šå¸¸ä½äº

/usr/local/nginx

**å‰ç«¯èµ„æºç»Ÿä¸€éƒ¨ç½²åœ¨ html ä¸‹**

```java
-nginxæ ¹ç›®å½•
    -config é…ç½®æ–‡ä»¶,ä¸»è¦æ˜¯configä¸‹çš„nagix.conf
    -html Â  é™æ€èµ„æº,å­˜æ‰“åŒ…åçš„distå†…çš„æ–‡ä»¶
    -log    æ—¥å¿—æ–‡ä»¶
```

## éƒ¨ç½²é™æ€èµ„æº

å…ˆåˆ‡æ¢åˆ° nginx ç›®å½•, é…ç½®å¥½ nginx é…ç½®, å¯åŠ¨ nginx

å†åˆ‡æ¢åˆ° nginx çš„ html ç›®å½•, rm rf *æ¸…ç©ºæ‰€æœ‰èµ„æº

rz ä¸Šä¼ èµ„æº

unzip è§£å‹ zip æ–‡ä»¶

ls æŸ¥çœ‹

```nginx
yum install nginx //ä¸‹è½½nginx
cd /
ls
cd /etc
ls
cd nginx
ls
//åˆ°è¾¾nginxç›®å½•å
service nginx start Â  Â //å¯åŠ¨nginxæœåŠ¡
vi nginx.conf Â  Â //ç”¨vimç¼–è¾‘å™¨æ‰“å¼€nginxé…ç½®æ–‡ä»¶
â€‹
i Â  Â //æ’å…¥
â€‹
...
http{
    ...
	server{
			location / {
			alias E:/project/trasen/dist; #æ‰“åŒ…ä»¥åçš„é¡¹ç›®åœ°å€
			try_files $uri $uri/ /index.html; #è§£å†³404é—®é¢˜
			# proxy_pass http://192.168.74.237:5173/residentdoctor/; #å¼€å‘æ—¶è¿è¡Œè®¿é—®åœ°å€
			    
			# root é»˜è®¤è®¿é—®è·¯å¾„ //æ”¹æˆdistç›®å½•åœ°å€
			# index index.html
			# vue-router@3å®˜æ–¹æä¾›çš„historyæ¨¡å¼ä¸‹404è·³é¦–é¡µçš„é…ç½®
			# try_files $uri $uri/ /index.html
		}
		# ä»£ç†å¸¦/apiçš„è¯·æ±‚
		location /api {
				proxy_pass ç›®æ ‡æœåŠ¡å™¨ Â  Â # (è¯·æ±‚åœ°å€/api)æ—¶,éœ€è¦ä»£ç†åˆ°çš„ç›®æ ‡æœåŠ¡å™¨
		}
    }
}
â€‹
:wq Â  Â //ä¿å­˜å¹¶é€€å‡ºvim
service nginx restart Â  Â //é‡å¯nginxæœåŠ¡
```